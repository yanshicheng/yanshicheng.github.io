<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>test | 闫世成 SRE运维之路</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <link rel="stylesheet" href="/styles/index.css">
    <noscript><meta http-equiv="refresh" content="0; url=https://www.yanshicheng.com/noscript/"><style>.theme-vdoing-content { display:none }</noscript>
    <script src="https://cdn.staticfile.org/twikoo/1.6.7/twikoo.all.min.js"></script>
    <script>var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?f06618722a8bed59d75788172aef88ca"; 
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
          })();
          </script>
    <meta name="description" content="YanShicheng Sre 运维知识库。">
    <meta name="baidu-site-verification" content="codeva-i1I7g2e68F">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="闫世成 SRE架构之路" content="闫世成 个人知识库，SRE 运维知识库。">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.7cedc967.css" as="style"><link rel="preload" href="/assets/js/app.4d013cf5.js" as="script"><link rel="preload" href="/assets/js/2.3e576c84.js" as="script"><link rel="preload" href="/assets/js/41.065fd559.js" as="script"><link rel="preload" href="/assets/js/15.2849772b.js" as="script"><link rel="preload" href="/assets/js/7.5f97d280.js" as="script"><link rel="prefetch" href="/assets/js/10.629a24c0.js"><link rel="prefetch" href="/assets/js/11.c6c3f665.js"><link rel="prefetch" href="/assets/js/12.740f53fb.js"><link rel="prefetch" href="/assets/js/13.eb2156d1.js"><link rel="prefetch" href="/assets/js/14.c030ad4a.js"><link rel="prefetch" href="/assets/js/16.5730be72.js"><link rel="prefetch" href="/assets/js/17.6bb4d7d1.js"><link rel="prefetch" href="/assets/js/18.00d9bff5.js"><link rel="prefetch" href="/assets/js/19.dfa3593d.js"><link rel="prefetch" href="/assets/js/20.aeaa192e.js"><link rel="prefetch" href="/assets/js/21.8c18908b.js"><link rel="prefetch" href="/assets/js/22.2c3bba86.js"><link rel="prefetch" href="/assets/js/23.acc6a830.js"><link rel="prefetch" href="/assets/js/24.8bc85191.js"><link rel="prefetch" href="/assets/js/25.fe10ea4c.js"><link rel="prefetch" href="/assets/js/26.d93473bf.js"><link rel="prefetch" href="/assets/js/27.178d3a65.js"><link rel="prefetch" href="/assets/js/28.a3005ae1.js"><link rel="prefetch" href="/assets/js/29.4dfc98b4.js"><link rel="prefetch" href="/assets/js/3.54b040a5.js"><link rel="prefetch" href="/assets/js/30.d434609d.js"><link rel="prefetch" href="/assets/js/31.e451eb8d.js"><link rel="prefetch" href="/assets/js/32.90c9e75a.js"><link rel="prefetch" href="/assets/js/33.d28d715a.js"><link rel="prefetch" href="/assets/js/34.b0ee9706.js"><link rel="prefetch" href="/assets/js/35.31c6edef.js"><link rel="prefetch" href="/assets/js/36.7a4290f9.js"><link rel="prefetch" href="/assets/js/37.be852255.js"><link rel="prefetch" href="/assets/js/38.55f8d6b2.js"><link rel="prefetch" href="/assets/js/39.66beb064.js"><link rel="prefetch" href="/assets/js/4.7b5de6ae.js"><link rel="prefetch" href="/assets/js/40.26d244d2.js"><link rel="prefetch" href="/assets/js/42.619efcfd.js"><link rel="prefetch" href="/assets/js/43.0c61546e.js"><link rel="prefetch" href="/assets/js/44.7bc12009.js"><link rel="prefetch" href="/assets/js/45.eee015f7.js"><link rel="prefetch" href="/assets/js/46.ff6d2497.js"><link rel="prefetch" href="/assets/js/47.ee68f6e1.js"><link rel="prefetch" href="/assets/js/48.aecb8d93.js"><link rel="prefetch" href="/assets/js/49.e2afdb5b.js"><link rel="prefetch" href="/assets/js/5.a4edadfa.js"><link rel="prefetch" href="/assets/js/50.101e28ba.js"><link rel="prefetch" href="/assets/js/51.5137341b.js"><link rel="prefetch" href="/assets/js/52.13502e23.js"><link rel="prefetch" href="/assets/js/53.5fe6f75e.js"><link rel="prefetch" href="/assets/js/54.5696bc5c.js"><link rel="prefetch" href="/assets/js/55.bed2c041.js"><link rel="prefetch" href="/assets/js/56.c13079ee.js"><link rel="prefetch" href="/assets/js/6.38b51ba3.js"><link rel="prefetch" href="/assets/js/8.f9a959dd.js"><link rel="prefetch" href="/assets/js/9.8d4c65ae.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7cedc967.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/index/logo.png" alt="闫世成 SRE运维之路" class="logo"> <span class="site-name can-hide">闫世成 SRE运维之路</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="linux" class="dropdown-title"><a href="/linux/" class="link-title">linux</a> <span class="title" style="display:none;">linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/basic/" class="nav-link">基础</a></li><li class="dropdown-subitem"><a href="/linux/iptables/" class="nav-link">防火墙</a></li></ul></li><li class="dropdown-item"><h4>web</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/nginx/" class="nav-link">nginx</a></li><li class="dropdown-subitem"><a href="/linux/tomcat/" class="nav-link">tomcat</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="devops" class="dropdown-title"><a href="/devops/" class="link-title">devops</a> <span class="title" style="display:none;">devops</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/devops/gitlab/" class="nav-link">Gitlab</a></li><li class="dropdown-subitem"><a href="/devops/sonar/" class="nav-link">Sonar</a></li><li class="dropdown-subitem"><a href="/devops/nexus/" class="nav-link">Nexus</a></li><li class="dropdown-subitem"><a href="/devops/jenkins/" class="nav-link">Jenkins</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/mysql/" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/database/mongodb/" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="监控日志" class="dropdown-title"><a href="/monitoring-logging/" class="link-title">监控日志</a> <span class="title" style="display:none;">监控日志</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>监控</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/monitoring-logging/prometheus/" class="nav-link">Prometheus</a></li><li class="dropdown-subitem"><a href="/monitoring-logging/grafana/" class="nav-link">Grafana</a></li><li class="dropdown-subitem"><a href="/monitoring-logging/alertmanager/" class="nav-link">AlertManager</a></li></ul></li><li class="dropdown-item"><h4>日志</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/monitoring-logging/elk/" class="nav-link">ELK</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="kubernetes" class="dropdown-title"><a href="/kubernetes/" class="link-title">kubernetes</a> <span class="title" style="display:none;">kubernetes</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docker/" class="nav-link">docker</a></li><li class="dropdown-subitem"><a href="/kubernetes/basic/" class="nav-link">kubernetes</a></li><li class="dropdown-subitem"><a href="/kubernetes/case/" class="nav-link">案例</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="云原生" class="dropdown-title"><a href="/cloud-native/" class="link-title router-link-active">云原生</a> <span class="title" style="display:none;">云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>微服务治理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/cloud-native/envoy/" class="nav-link router-link-active">Envoy</a></li><li class="dropdown-subitem"><a href="/cloud-native/istio/" class="nav-link">Istio</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://www.pgoops.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  运维平台[Py]
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.yanshicheng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  运维平台[Go]
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://docks.yanshicheng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  运维知识库[Go]
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://coder.yanshicheng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开发知识库[Go]
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/message-area/" class="nav-link">留言区</a></div> <a href="https://github.com/yanshicheng/yanshicheng.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://wiki-images.yanshicheng.com/static/202407281359303.jpg"> <div class="blogger-info"><h3>YanShicheng</h3> <span>SRE运维知识库！</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="linux" class="dropdown-title"><a href="/linux/" class="link-title">linux</a> <span class="title" style="display:none;">linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/basic/" class="nav-link">基础</a></li><li class="dropdown-subitem"><a href="/linux/iptables/" class="nav-link">防火墙</a></li></ul></li><li class="dropdown-item"><h4>web</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/nginx/" class="nav-link">nginx</a></li><li class="dropdown-subitem"><a href="/linux/tomcat/" class="nav-link">tomcat</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="devops" class="dropdown-title"><a href="/devops/" class="link-title">devops</a> <span class="title" style="display:none;">devops</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/devops/gitlab/" class="nav-link">Gitlab</a></li><li class="dropdown-subitem"><a href="/devops/sonar/" class="nav-link">Sonar</a></li><li class="dropdown-subitem"><a href="/devops/nexus/" class="nav-link">Nexus</a></li><li class="dropdown-subitem"><a href="/devops/jenkins/" class="nav-link">Jenkins</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/mysql/" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/database/mongodb/" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="监控日志" class="dropdown-title"><a href="/monitoring-logging/" class="link-title">监控日志</a> <span class="title" style="display:none;">监控日志</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>监控</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/monitoring-logging/prometheus/" class="nav-link">Prometheus</a></li><li class="dropdown-subitem"><a href="/monitoring-logging/grafana/" class="nav-link">Grafana</a></li><li class="dropdown-subitem"><a href="/monitoring-logging/alertmanager/" class="nav-link">AlertManager</a></li></ul></li><li class="dropdown-item"><h4>日志</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/monitoring-logging/elk/" class="nav-link">ELK</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="kubernetes" class="dropdown-title"><a href="/kubernetes/" class="link-title">kubernetes</a> <span class="title" style="display:none;">kubernetes</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docker/" class="nav-link">docker</a></li><li class="dropdown-subitem"><a href="/kubernetes/basic/" class="nav-link">kubernetes</a></li><li class="dropdown-subitem"><a href="/kubernetes/case/" class="nav-link">案例</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="云原生" class="dropdown-title"><a href="/cloud-native/" class="link-title router-link-active">云原生</a> <span class="title" style="display:none;">云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>微服务治理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/cloud-native/envoy/" class="nav-link router-link-active">Envoy</a></li><li class="dropdown-subitem"><a href="/cloud-native/istio/" class="nav-link">Istio</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://www.pgoops.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  运维平台[Py]
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.yanshicheng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  运维平台[Go]
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://docks.yanshicheng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  运维知识库[Go]
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://coder.yanshicheng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开发知识库[Go]
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/message-area/" class="nav-link">留言区</a></div> <a href="https://github.com/yanshicheng/yanshicheng.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>envoy</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cloud-native/envoy/" aria-current="page" class="sidebar-link">envoy</a></li><li><a href="/cloud-native/envoy/20240804001635/" aria-current="page" class="active sidebar-link">test</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/cloud-native/envoy/20240804001635/#概念" class="sidebar-link">概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/cloud-native/envoy/20240804001635/#服务韧性-service-resilience" class="sidebar-link">服务韧性（Service Resilience）</a></li><li class="sidebar-sub-header level3"><a href="/cloud-native/envoy/20240804001635/#混沌工程-chaos-engineering" class="sidebar-link">混沌工程（Chaos Engineering）</a></li><li class="sidebar-sub-header level3"><a href="/cloud-native/envoy/20240804001635/#故障注入-fault-injection" class="sidebar-link">故障注入（Fault Injection）</a></li><li class="sidebar-sub-header level3"><a href="/cloud-native/envoy/20240804001635/#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header level4"><a href="/cloud-native/envoy/20240804001635/#混沌工程和故障注入的概念与区别" class="sidebar-link">混沌工程和故障注入的概念与区别</a></li><li class="sidebar-sub-header level4"><a href="/cloud-native/envoy/20240804001635/#混沌工程实验的输入样例-扩展" class="sidebar-link">混沌工程实验的输入样例（扩展）</a></li><li class="sidebar-sub-header level4"><a href="/cloud-native/envoy/20240804001635/#故障注入的具体样例-扩展" class="sidebar-link">故障注入的具体样例（扩展）</a></li><li class="sidebar-sub-header level3"><a href="/cloud-native/envoy/20240804001635/#envoy-http-故障注入过滤器" class="sidebar-link">Envoy Http 故障注入过滤器</a></li><li class="sidebar-sub-header level3"><a href="/cloud-native/envoy/20240804001635/#envoy-局部故障处理机制" class="sidebar-link">envoy 局部故障处理机制</a></li><li class="sidebar-sub-header level4"><a href="/cloud-native/envoy/20240804001635/#重试-retry" class="sidebar-link">重试 (Retry)</a></li><li class="sidebar-sub-header level4"><a href="/cloud-native/envoy/20240804001635/#超时-timeout" class="sidebar-link">超时 (Timeout)</a></li><li class="sidebar-sub-header level4"><a href="/cloud-native/envoy/20240804001635/#断路器-circuit-breaker" class="sidebar-link">断路器 (Circuit Breaker)</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/cloud-native/envoy/20240804001635/#注入延迟-fault-injection-delay" class="sidebar-link">注入延迟 (Fault Injection Delay)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/cloud-native/envoy/20240804001635/#参数" class="sidebar-link">参数</a></li><li class="sidebar-sub-header level4"><a href="/cloud-native/envoy/20240804001635/#fixed-delay-固定延迟" class="sidebar-link">Fixed Delay (固定延迟)</a></li><li class="sidebar-sub-header level4"><a href="/cloud-native/envoy/20240804001635/#header-delay-头部延迟" class="sidebar-link">Header Delay (头部延迟)</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/cloud-native/envoy/20240804001635/#注入请求终止-fault-injection-abort" class="sidebar-link">注入请求终止 (Fault Injection Abort)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/cloud-native/envoy/20240804001635/#参数-2" class="sidebar-link">参数</a></li><li class="sidebar-sub-header level4"><a href="/cloud-native/envoy/20240804001635/#固定http状态码" class="sidebar-link">固定HTTP状态码</a></li><li class="sidebar-sub-header level4"><a href="/cloud-native/envoy/20240804001635/#grpc状态码" class="sidebar-link">gRPC状态码</a></li><li class="sidebar-sub-header level4"><a href="/cloud-native/envoy/20240804001635/#头部终止条件" class="sidebar-link">头部终止条件</a></li><li class="sidebar-sub-header level3"><a href="/cloud-native/envoy/20240804001635/#配置示例" class="sidebar-link">配置示例</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/cloud-native/envoy/20240804001635/#响应报文的速率限制-response-rate-limit" class="sidebar-link">响应报文的速率限制 (Response Rate Limit)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/cloud-native/envoy/20240804001635/#参数-3" class="sidebar-link">参数</a></li><li class="sidebar-sub-header level4"><a href="/cloud-native/envoy/20240804001635/#固定速率限制" class="sidebar-link">固定速率限制</a></li><li class="sidebar-sub-header level4"><a href="/cloud-native/envoy/20240804001635/#头部速率限制" class="sidebar-link">头部速率限制</a></li></ul></li></ul></li><li><a href="/cloud-native/envoy/20240804001641/" class="sidebar-link">test</a></li><li><a href="/cloud-native/envoy/20240804001649/" class="sidebar-link">test</a></li><li><a href="/cloud-native/envoy/20240804001656/" class="sidebar-link">test</a></li><li><a href="/cloud-native/envoy/20240804001703/" class="sidebar-link">test</a></li><li><a href="/cloud-native/envoy/20240804001722/" class="sidebar-link">test</a></li><li><a href="/cloud-native/envoy/20240804001732/" class="sidebar-link">test</a></li><li><a href="/cloud-native/envoy/20240801150921/" class="sidebar-link">HTTP 路由配置基础</a></li><li><a href="/cloud-native/envoy/20240803202950/" class="sidebar-link">流量高级治理</a></li><li><a href="/cloud-native/envoy/20240804001357/" class="sidebar-link">服务韧性-混沌工程</a></li><li><a href="/cloud-native/envoy/20240801/" class="sidebar-link">xxxx</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>istio</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=cloud-native" title="分类" data-v-06225672>cloud-native</a></li><li data-v-06225672><a href="/categories/?category=envoy" title="分类" data-v-06225672>envoy</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="javascript:;" data-v-06225672>Yan Shicheng</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-08-04</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">test<!----></h1> <!----> <div class="theme-vdoing-content content__default"><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>title: 这是一个提示
这是一个提示内容。</p></div> <h2 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h2> <h3 id="服务韧性-service-resilience"><a href="#服务韧性-service-resilience" class="header-anchor">#</a> 服务韧性（Service Resilience）</h3> <p>服务韧性是指系统在面对各种故障、压力和变化时保持功能和性能的能力。它强调系统能够优雅地处理失败，快速恢复，并持续提供服务。</p> <ol><li>容错能力：能够在部分组件失败的情况下继续运行。</li> <li>自我修复：自动检测并修复故障。</li> <li>负载均衡：有效分配资源和请求。</li> <li>优雅降级：在资源不足时，保证核心功能运行。</li> <li>快速恢复：从故障中迅速恢复正常状态。
实现方法</li></ol> <ul><li>采用微服务架构，实现服务隔离。</li> <li>使用断路器模式，防止级联故障。</li> <li>实施重试机制和超时控制。</li> <li>采用异步通信，减少服务间依赖。</li> <li>实现服务发现和动态路由。
在现代复杂的分布式系统中，服务韧性对于保证系统的可用性和可靠性至关重要，尤其在面对不可预知的故障和压力时。</li></ul> <h3 id="混沌工程-chaos-engineering"><a href="#混沌工程-chaos-engineering" class="header-anchor">#</a> 混沌工程（Chaos Engineering）</h3> <p>混沌工程是一种通过主动引入故障和异常情况来识别系统弱点的实践方法。它旨在提高系统的可靠性和韧性。
对于架构师: 验证系统架构的容错能力，比如验证现在提倡的面向失败设计的系统。
对于开发和运维: 提高故障的应急效率， 实现故障告警，定位，恢复的有效和高效性。
对于测试: 弥补传统测试方法留下的空白，混沌功能从系统的角度进行测试，降低故障复发率，这有别与传统测试方法从用户角度的进行测试。
对于产品和设计: 通过混沌事件查看产品的表现，提高客户使用体验。</p> <ol><li>建立稳态假设：定义系统正常运行的基准。</li> <li>构建假设：假设在特定故障情况下系统的行为。</li> <li>设计实验：设计和执行能验证或推翻假设的实验。</li> <li>验证结果：分析实验结果，改进系统。</li> <li>自动化：将混沌实验自动化，作为持续测试的一部分。
实施步骤</li> <li>从小规模开始，逐步增加实验复杂度。</li> <li>在非生产环境中进行初步测试。</li> <li>谨慎地在生产环境中执行实验。</li> <li>持续监控和分析系统行为。</li> <li>根据实验结果改进系统设计和架构。
工具和平台</li></ol> <ul><li>Netflix Chaos Monkey</li> <li>Gremlin</li> <li>Chaos Toolkit</li> <li>AWS Fault Injection Simulator
优势</li> <li>提前发现系统弱点。</li> <li>增强团队对系统行为的理解。</li> <li>提高系统整体可靠性和韧性。</li> <li>培养团队的事故应对能力。</li></ul> <div class="custom-block danger"><p class="custom-block-title">警告</p> <p>危险信息</p></div> <h3 id="故障注入-fault-injection"><a href="#故障注入-fault-injection" class="header-anchor">#</a> 故障注入（Fault Injection）</h3> <p>故障注入是一种有意引入错误、延迟或异常行为到系统中的技术，用于测试系统的容错能力和行为。
主要类型</p> <ol><li>网络故障：延迟、丢包、断连。</li> <li>资源耗尽：CPU、内存、磁盘空间耗尽。</li> <li>服务故障：服务崩溃、响应错误。</li> <li>数据故障：数据损坏、不一致。
实现方法</li> <li>代码级注入：在应用代码中添加故障触发点。</li> <li>网络层注入：使用代理或防火墙规则模拟网络问题。</li> <li>容器层注入：在容器运行时注入故障。</li> <li>基础设施层注入：在虚拟机或物理机层面注入故障。
工具</li></ol> <ul><li>Istio 故障注入功能</li> <li>Chaos Mesh</li> <li>Pumba (针对Docker容器)</li> <li>Toxiproxy（网络故障模拟）
最佳实践</li></ul> <ol><li>从简单故障开始，逐步增加复杂度。</li> <li>结合监控系统，全面观察系统行为。</li> <li>在测试环境充分验证后再考虑生产环境。</li> <li>制定明确的回滚计划。</li> <li>记录和分析每次故障注入的结果。
与混沌工程的关系
故障注入是混沌工程的一个重要工具。混沌工程使用故障注入作为一种手段来执行实验，但混沌工程还包括更广泛的策略和方法论。</li></ol> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>这三个概念紧密相关，共同致力于提高系统的可靠性和韧性：</p> <ul><li>服务韧性是目标，它定义了我们希望系统具备的特性。</li> <li>混沌工程是一种方法论，用于系统地提高和验证服务韧性。</li> <li>故障注入是一种具体技术，是实现混沌工程和测试服务韧性的重要工具。</li></ul> <h4 id="混沌工程和故障注入的概念与区别"><a href="#混沌工程和故障注入的概念与区别" class="header-anchor">#</a> 混沌工程和故障注入的概念与区别</h4> <ul><li>混沌工程是发现新信息的实验过程，而故障注入是对特定条件或变量的测试方法。</li> <li>测试和实验有着重要区别：
<ul><li>测试只产生二元的结果（通过或失败），不能发掘系统未知或尚不明确的认知。</li> <li>实验可以产生新的认知，通常能够开辟出更广泛的对复杂系统的认知空间。</li></ul></li> <li>混沌工程不仅仅是制造服务中断等故障：
<ul><li>并不是所有实验都可以有建设性、高效地发现问题。</li> <li>除了故障类场景，还存在非故障类场景，如流量激增、资源竞争、拜占庭故障等。</li></ul></li></ul> <ol><li>流量激增</li></ol> <ul><li>定义：指在短时间内系统请求量急剧增加的情况。</li> <li>原因：可能由于突发事件、营销活动、病毒式传播等引起。</li> <li>影响：
<ul><li>可能导致系统过载，响应时间增加。</li> <li>可能触发自动扩展机制，增加资源消耗和成本。</li> <li>可能导致缓存失效，增加后端数据库压力。</li></ul></li> <li>测试方法：
<ul><li>使用负载测试工具模拟突发流量。</li> <li>逐步增加流量，观察系统的扩展能力和性能变化。</li> <li>模拟不同类型的请求组合，如读密集型vs写密集型。</li></ul></li></ul> <ol start="2"><li>资源竞争</li></ol> <ul><li>定义：多个进程或线程同时争夺有限的系统资源。</li> <li>常见资源：CPU、内存、磁盘I/O、网络带宽、数据库连接等。</li> <li>影响：
<ul><li>可能导致系统响应变慢。</li> <li>可能引发死锁或饥饿状态。</li> <li>可能造成某些任务长时间无法完成。</li></ul></li> <li>测试方法：
<ul><li>人为创造资源紧张状况，如启动大量计算密集型任务。</li> <li>模拟数据库连接池耗尽的情况。</li> <li>创造多个服务同时大量读写共享资源的场景。</li></ul></li></ul> <ol start="3"><li>拜占庭故障</li></ol> <ul><li>定义：系统中的某个组件表现不一致，对不同的观察者呈现不同的症状。</li> <li>特点：这类故障难以检测，因为故障组件可能看似正常运行。</li> <li>影响：
<ul><li>可能导致系统行为不一致。</li> <li>可能引发数据不一致或损坏。</li> <li>在分布式系统中尤其危险，可能导致共识算法失效。</li></ul></li> <li>测试方法：
<ul><li>模拟节点发送矛盾的信息给不同的接收者。</li> <li>创造某个服务在不同调用中返回不一致结果的情况。</li> <li>在分布式系统中注入时钟偏移，导致时序问题。</li></ul></li></ul> <ol start="4"><li>其他非故障类场景</li></ol> <ul><li>数据倾斜：在分布式系统中，数据或工作负载不均匀分布。
<ul><li>测试方法：创造热点数据，观察系统如何处理不均衡的负载。</li></ul></li> <li>配置漂移：系统配置随时间逐渐偏离预期状态。
<ul><li>测试方法：模拟配置文件被意外修改或不同步的情况。</li></ul></li> <li>依赖服务降级：外部服务性能下降但未完全失效。
<ul><li>测试方法：降低模拟外部服务的响应速度，观察系统反应。</li></ul></li></ul> <h4 id="混沌工程实验的输入样例-扩展"><a href="#混沌工程实验的输入样例-扩展" class="header-anchor">#</a> 混沌工程实验的输入样例（扩展）</h4> <ul><li>模拟整个云服务区域或整个数据中心故障</li> <li>跨多实例删除部分Kafka topic来重现生产环境中发生过的问题</li> <li>挑选特定时间段和流量，对其涉及的服务间调用注入特定的延时</li> <li>方法级别的混乱（运行时注入）：让方法随机抛出各种异常</li> <li>在代码中插入指令，允许在这些指令之前运行故障注入</li> <li>强制系统节点间的时间不同步</li> <li>在驱动程序中执行模拟I/O错误的程序</li> <li>让某个Elasticsearch集群CPU超负荷</li></ul> <h4 id="故障注入的具体样例-扩展"><a href="#故障注入的具体样例-扩展" class="header-anchor">#</a> 故障注入的具体样例（扩展）</h4> <ul><li>CPU高负载</li> <li>磁盘高负载：频繁读写磁盘</li> <li>磁盘空间不足</li> <li>优雅的下线应用：使用应用的stop脚本平滑地停止应用</li> <li>通过kill进程直接停止应用，可能造成数据不一致</li> <li>网络恶化：随机改变一些包数据，使数据内容不正确</li> <li>网络延迟：将包延迟一个特定范围的时间</li> <li>网络丢包：构造一个tcp不会完全失败的丢包率</li> <li>网络黑洞：忽略来自某个ip的包</li> <li>外部服务不可达：将外部服务的域名指向本地环回地址或将访问外部服务的端口的OUTPUT数据包丢弃</li></ul> <h3 id="envoy-http-故障注入过滤器"><a href="#envoy-http-故障注入过滤器" class="header-anchor">#</a> Envoy Http 故障注入过滤器</h3> <p>故障注入在 Envoy 中的实现上类似于重定向，重写，重试，他们通过修改 HTTP 请求或者应答的内容完成，</p> <ul><li>它由专用的故障注入过滤器(fault.injection)实现，用于测试微服务对不通形式的故障韧性</li> <li>他通过用户指定的错误代码注入延迟(delay)和请求终止(abort),从而模拟出分阶段的不同故障情形。</li> <li>故障范围仅限于通过网络及性能通信的的应用程序可观察到的范围，不支持模拟本地主机上的CPU和磁盘故障。</li></ul> <h3 id="envoy-局部故障处理机制"><a href="#envoy-局部故障处理机制" class="header-anchor">#</a> envoy 局部故障处理机制</h3> <h4 id="重试-retry"><a href="#重试-retry" class="header-anchor">#</a> 重试 (Retry)</h4> <p>分布式环境中对远程资源和服务的调用可能会由于<strong>瞬态故障</strong>（短时间内可自行恢复的故障）而失败。一般情况下，重试机制可以解决此类问题。</p> <ul><li>常见的瞬态故障有网络连接速度慢、超时、资源过量使用或暂时不可用等。</li> <li>envoy 可以配置超时 (Timeout)来快速失败，可以不让请求阻塞在故障后端上，而是 envoy 发起重试机制，把请求转移到后端其他端点，最终取决于会话绑定等机制。</li></ul> <h4 id="超时-timeout"><a href="#超时-timeout" class="header-anchor">#</a> 超时 (Timeout)</h4> <p>此外，也存在因意外事件而导致故障，并且可能需要较长的时间才能恢复。</p> <ul><li>此类故障的严重性范围涵盖从部分连接中断到服务完全失败：
<ul><li>连续重试和长时间的等待对该类场景没有太大意义。</li> <li>应用程序应迅速接受该操作已失败并主动地应对该失败。</li></ul></li> <li>可以将调用服务的操作配置为实施“超时”，若该服务在超时内未能响应，则以失败消息响应：
<ul><li>这样可以避免长时间等待导致的资源浪费和系统不稳定。</li></ul></li></ul> <h4 id="断路器-circuit-breaker"><a href="#断路器-circuit-breaker" class="header-anchor">#</a> 断路器 (Circuit Breaker)</h4> <p>还有，若服务非常繁忙，则系统某一部分的故障对此，简单的超时策略可能导致对同一操作的许多并发请求被阻止，直到超时时长耗尽为止。</p> <ul><li>这些被阻止的请求可能包含关键的系统资源，例如内存、线程和数据库连接等：
<ul><li>这些资源的耗尽可能导致需要使用相关资源的系统其他可能不相关的部分出现故障。</li> <li>于是，此时最好立即使操作失败，并且仅在仅可能成功的情况下才尝试调用服务。</li></ul></li></ul> <h2 id="注入延迟-fault-injection-delay"><a href="#注入延迟-fault-injection-delay" class="header-anchor">#</a> 注入延迟 (Fault Injection Delay)</h2> <h3 id="参数"><a href="#参数" class="header-anchor">#</a> 参数</h3> <p>注入延迟允许你在请求处理之前人为地增加延迟，以模拟网络延迟或其他延迟情况。Envoy通过配置<code>fault</code>滤波器来实现这一功能。</p> <h4 id="fixed-delay-固定延迟"><a href="#fixed-delay-固定延迟" class="header-anchor">#</a> Fixed Delay (固定延迟)</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">fault</span><span class="token punctuation">:</span>
  <span class="token key atrule">delay</span><span class="token punctuation">:</span>
    <span class="token key atrule">fixed_delay</span><span class="token punctuation">:</span>
      <span class="token comment"># 固定延迟时间，可以是秒或毫秒</span>
      <span class="token key atrule">seconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
      <span class="token comment"># 或者使用 milliseconds 参数</span>
      <span class="token key atrule">milliseconds</span><span class="token punctuation">:</span> <span class="token number">5000</span>
    <span class="token key atrule">percentage</span><span class="token punctuation">:</span>
      <span class="token comment"># 应用延迟的请求百分比 (0-100)</span>
      <span class="token key atrule">numerator</span><span class="token punctuation">:</span> <span class="token number">100</span>
      <span class="token key atrule">denominator</span><span class="token punctuation">:</span> HUNDRED
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>参数说明：</strong></p> <ul><li><code>fixed_delay</code>: 指定固定的延迟时间，可以使用<code>seconds</code>（秒）或<code>milliseconds</code>（毫秒）。这两个参数不能同时使用。
<ul><li><code>seconds</code>: 延迟时间，以秒为单位。</li> <li><code>milliseconds</code>: 延迟时间，以毫秒为单位。</li></ul></li> <li><code>percentage</code>: 指定应应用延迟的请求百分比，<strong>用于</strong>控制延迟故障注入的概率。
<ul><li><code>numerator</code>: 延迟应用比例的分子。</li> <li><code>denominator</code>: 延迟应用比例的分母。可以是<code>HUNDRED</code>（100），<code>TEN_THOUSAND</code>（10000），或<code>MILLION</code>（1000000）。</li></ul></li></ul> <h4 id="header-delay-头部延迟"><a href="#header-delay-头部延迟" class="header-anchor">#</a> Header Delay (头部延迟)</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">fault</span><span class="token punctuation">:</span>
  <span class="token key atrule">delay</span><span class="token punctuation">:</span>
    <span class="token key atrule">header_delay</span><span class="token punctuation">:</span>
      <span class="token key atrule">header_name</span><span class="token punctuation">:</span> <span class="token string">&quot;x-envoy-fault-delay-request&quot;</span>
    <span class="token key atrule">percentage</span><span class="token punctuation">:</span>
      <span class="token comment"># 应用延迟的请求百分比 (0-100)</span>
      <span class="token key atrule">numerator</span><span class="token punctuation">:</span> <span class="token number">100</span>
      <span class="token key atrule">denominator</span><span class="token punctuation">:</span> HUNDRED
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>参数说明：</strong></p> <ul><li><code>header_delay</code>: 根据请求头中的延迟值来设置延迟。
<ul><li><code>header_name</code>: 请求头的名称，值为延迟时间，单位为毫秒。</li></ul></li> <li><code>percentage</code>: 指定应应用延迟的请求百分比，用于控制延迟故障注入的概率。
<ul><li><code>numerator</code>: 延迟应用比例的分子。</li> <li><code>denominator</code>: 延迟应用比例的分母。可以是<code>HUNDRED</code>（100），<code>TEN_THOUSAND</code>（10000），或<code>MILLION</code>（1000000）。</li></ul></li></ul> <h2 id="注入请求终止-fault-injection-abort"><a href="#注入请求终止-fault-injection-abort" class="header-anchor">#</a> 注入请求终止 (Fault Injection Abort)</h2> <p>Envoy支持通过<code>fault</code>滤波器注入请求终止，以模拟服务器错误或其他终止条件。</p> <h3 id="参数-2"><a href="#参数-2" class="header-anchor">#</a> 参数</h3> <h4 id="固定http状态码"><a href="#固定http状态码" class="header-anchor">#</a> 固定HTTP状态码</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">fault</span><span class="token punctuation">:</span>
  <span class="token key atrule">abort</span><span class="token punctuation">:</span>
    <span class="token key atrule">http_status</span><span class="token punctuation">:</span>
      <span class="token comment"># 终止请求返回的HTTP状态码</span>
      <span class="token key atrule">code</span><span class="token punctuation">:</span> <span class="token number">503</span>
    <span class="token key atrule">percentage</span><span class="token punctuation">:</span>
      <span class="token comment"># 应用终止的请求百分比 (0-100)</span>
      <span class="token key atrule">numerator</span><span class="token punctuation">:</span> <span class="token number">100</span>
      <span class="token key atrule">denominator</span><span class="token punctuation">:</span> HUNDRED
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>参数说明：</strong></p> <ul><li><code>http_status</code>: 指定返回的HTTP状态码。
<ul><li><code>code</code>: 返回的HTTP状态码（如503表示服务不可用）。</li></ul></li> <li><code>percentage</code>: 指定应应用终止的请求百分比。
<ul><li><code>numerator</code>: 终止应用比例的分子。</li> <li><code>denominator</code>: 终止应用比例的分母。可以是<code>HUNDRED</code>（100），<code>TEN_THOUSAND</code>（10000），或<code>MILLION</code>（1000000）。</li></ul></li></ul> <h4 id="grpc状态码"><a href="#grpc状态码" class="header-anchor">#</a> gRPC状态码</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">fault</span><span class="token punctuation">:</span>
  <span class="token key atrule">abort</span><span class="token punctuation">:</span>
    <span class="token key atrule">grpc_status</span><span class="token punctuation">:</span>
      <span class="token comment"># 终止请求返回的gRPC状态码</span>
      <span class="token key atrule">status</span><span class="token punctuation">:</span> UNAVAILABLE
    <span class="token key atrule">percentage</span><span class="token punctuation">:</span>
      <span class="token comment"># 应用终止的请求百分比 (0-100)</span>
      <span class="token key atrule">numerator</span><span class="token punctuation">:</span> <span class="token number">100</span>
      <span class="token key atrule">denominator</span><span class="token punctuation">:</span> HUNDRED
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>参数说明：</strong></p> <ul><li><code>grpc_status</code>: 指定返回的gRPC状态码。
<ul><li><code>status</code>: 返回的gRPC状态码（如<code>UNAVAILABLE</code>）。</li></ul></li> <li><code>percentage</code>: 指定应应用终止的请求百分比。
<ul><li><code>numerator</code>: 终止应用比例的分子。</li> <li><code>denominator</code>: 终止应用比例的分母。可以是<code>HUNDRED</code>（100），<code>TEN_THOUSAND</code>（10000），或<code>MILLION</code>（1000000）。</li></ul></li></ul> <h4 id="头部终止条件"><a href="#头部终止条件" class="header-anchor">#</a> 头部终止条件</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">fault</span><span class="token punctuation">:</span>
  <span class="token key atrule">abort</span><span class="token punctuation">:</span>
    <span class="token key atrule">header_abort</span><span class="token punctuation">:</span>
      <span class="token key atrule">header_name</span><span class="token punctuation">:</span> <span class="token string">&quot;x-envoy-fault-abort-request&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>参数说明：</strong></p> <ul><li><code>header_abort</code>: 根据请求头中的终止条件来终止请求。
<ul><li><code>header_name</code>: 请求头的名称，值为终止条件（如HTTP状态码）。</li></ul></li></ul> <h3 id="配置示例"><a href="#配置示例" class="header-anchor">#</a> 配置示例</h3> <p>最大同时注入故障数量: 100。
注入故障返回 HTTP 状态码 503。
10%的请求注入故障 (percentage: numerator: 10, denominator: HUNDRED)。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">admin</span><span class="token punctuation">:</span>
  <span class="token key atrule">profile_path</span><span class="token punctuation">:</span> /tmp/envoy.prof  <span class="token comment"># 设置 Envoy 管理接口的性能分析文件路径，用于存储性能分析数据</span>
  <span class="token key atrule">access_log_path</span><span class="token punctuation">:</span> /dev/stdout   <span class="token comment"># 设置 Envoy 管理接口的访问日志路径，这里设置为标准输出</span>
  <span class="token key atrule">address</span><span class="token punctuation">:</span>
    <span class="token key atrule">socket_address</span><span class="token punctuation">:</span>
      <span class="token key atrule">address</span><span class="token punctuation">:</span> 0.0.0.0           <span class="token comment"># 设置管理接口的监听地址，0.0.0.0 表示监听所有网络接口</span>
      <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">9901</span>           <span class="token comment"># 管理接口的监听端口号，这里设置为 9901</span>

<span class="token key atrule">layered_runtime</span><span class="token punctuation">:</span>
  <span class="token key atrule">layers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> admin
    <span class="token key atrule">admin_layer</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>              <span class="token comment"># 管理层的运行时配置，可以通过此层动态更新配置，便于管理</span>

<span class="token key atrule">static_resources</span><span class="token punctuation">:</span>
  <span class="token key atrule">listeners</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> listener_0
    <span class="token key atrule">address</span><span class="token punctuation">:</span>
      <span class="token key atrule">socket_address</span><span class="token punctuation">:</span>
        <span class="token key atrule">address</span><span class="token punctuation">:</span> 0.0.0.0         <span class="token comment"># 设置监听器的监听地址，0.0.0.0 表示监听所有网络接口</span>
        <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">80</span>           <span class="token comment"># 监听器的端口号，这里设置为 80，表示 HTTP 默认端口</span>
    <span class="token key atrule">filter_chains</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">filters</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> envoy.filters.network.http_connection_manager
        <span class="token key atrule">typed_config</span><span class="token punctuation">:</span>
          <span class="token key atrule">&quot;@type&quot;</span><span class="token punctuation">:</span> type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager
          <span class="token key atrule">stat_prefix</span><span class="token punctuation">:</span> ingress_http     <span class="token comment"># 设置统计前缀，用于标识该 HTTP 连接管理器的统计信息</span>
          <span class="token key atrule">codec_type</span><span class="token punctuation">:</span> AUTO              <span class="token comment"># 自动选择 HTTP 编解码类型，可以是 HTTP1 或 HTTP2</span>
          <span class="token key atrule">route_config</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> local_route           <span class="token comment"># 路由配置的名称</span>
            <span class="token key atrule">virtual_hosts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> backend_app         <span class="token comment"># 虚拟主机的名称</span>
              <span class="token key atrule">domains</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">]</span>            <span class="token comment"># 该虚拟主机匹配的域名，* 表示匹配所有域名</span>
              <span class="token key atrule">routes</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">match</span><span class="token punctuation">:</span>
                  <span class="token key atrule">prefix</span><span class="token punctuation">:</span> <span class="token string">&quot;/&quot;</span>           <span class="token comment"># 路由匹配的前缀路径，这里匹配所有路径</span>
                <span class="token key atrule">route</span><span class="token punctuation">:</span>
                  <span class="token key atrule">cluster</span><span class="token punctuation">:</span> backend_app<span class="token punctuation">-</span>v10   <span class="token comment"># 请求将路由到名为 backend_app-v10 的集群</span>
                  <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 0.25s        <span class="token comment"># 请求超时时间设置为 0.25 秒</span>
                  <span class="token key atrule">request_mirror_policies</span><span class="token punctuation">:</span>  <span class="token comment"># 请求镜像策略</span>
                  <span class="token punctuation">-</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span> backend_app<span class="token punctuation">-</span>v20  <span class="token comment"># 将请求镜像到 backend_app-v20 集群</span>
                    <span class="token key atrule">runtime_fraction</span><span class="token punctuation">:</span>
                      <span class="token key atrule">default_value</span><span class="token punctuation">:</span>
                        <span class="token key atrule">numerator</span><span class="token punctuation">:</span> <span class="token number">20</span>
                        <span class="token key atrule">denominator</span><span class="token punctuation">:</span> HUNDRED  <span class="token comment"># 20%的请求将被镜像</span>
                      <span class="token key atrule">runtime_key</span><span class="token punctuation">:</span> <span class="token string">&quot;routing.request_mirror.backend_app&quot;</span>  <span class="token comment"># 运行时配置键，可以动态调整镜像比例</span>
          <span class="token key atrule">http_filters</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> envoy.filters.http.fault
            <span class="token key atrule">typed_config</span><span class="token punctuation">:</span>
              <span class="token key atrule">&quot;@type&quot;</span><span class="token punctuation">:</span> type.googleapis.com/envoy.extensions.filters.http.fault.v3.HTTPFault
              <span class="token key atrule">max_active_faults</span><span class="token punctuation">:</span> <span class="token number">100</span>  <span class="token comment"># 最大同时注入的故障数量</span>
              <span class="token key atrule">abort</span><span class="token punctuation">:</span>
                <span class="token key atrule">http_status</span><span class="token punctuation">:</span> <span class="token number">503</span>       <span class="token comment"># 指定返回的 HTTP 状态码，这里设置为 503，表示服务不可用</span>
                <span class="token key atrule">percentage</span><span class="token punctuation">:</span>
                  <span class="token key atrule">numerator</span><span class="token punctuation">:</span> <span class="token number">10</span>        <span class="token comment"># 注入故障的请求百分比，分子部分，表示 10%</span>
                  <span class="token key atrule">denominator</span><span class="token punctuation">:</span> HUNDRED <span class="token comment"># 注入故障的请求百分比，分母部分，表示 100</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> envoy.filters.http.router
            <span class="token key atrule">typed_config</span><span class="token punctuation">:</span>
              <span class="token key atrule">&quot;@type&quot;</span><span class="token punctuation">:</span> type.googleapis.com/envoy.extensions.filters.http.router.v3.Router  <span class="token comment"># 配置 HTTP 路由过滤器</span>

  <span class="token key atrule">clusters</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> backend_app<span class="token punctuation">-</span>v10
    <span class="token key atrule">connect_timeout</span><span class="token punctuation">:</span> 0.25s       <span class="token comment"># 设置连接超时时间为 0.25 秒</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> STRICT_DNS             <span class="token comment"># 集群类型为 STRICT_DNS，严格的 DNS 模式，会动态解析 DNS 并更新端点</span>
    <span class="token key atrule">lb_policy</span><span class="token punctuation">:</span> ROUND_ROBIN       <span class="token comment"># 负载均衡策略为 ROUND_ROBIN，轮询方式分配请求</span>
    <span class="token key atrule">load_assignment</span><span class="token punctuation">:</span>
      <span class="token key atrule">cluster_name</span><span class="token punctuation">:</span> backend_app<span class="token punctuation">-</span>v10  <span class="token comment"># 负载分配集群的名称</span>
      <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">lb_endpoints</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
            <span class="token key atrule">address</span><span class="token punctuation">:</span>
              <span class="token key atrule">socket_address</span><span class="token punctuation">:</span>
                <span class="token key atrule">address</span><span class="token punctuation">:</span> 172.31.1.11 <span class="token comment"># 后端服务的 IP 地址</span>
                <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">8080</span>     <span class="token comment"># 后端服务的端口号</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> backend_app<span class="token punctuation">-</span>v20
    <span class="token key atrule">connect_timeout</span><span class="token punctuation">:</span> 0.25s       <span class="token comment"># 设置连接超时时间为 0.25 秒</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> STRICT_DNS             <span class="token comment"># 集群类型为 STRICT_DNS，严格的 DNS 模式，会动态解析 DNS 并更新端点</span>
    <span class="token key atrule">lb_policy</span><span class="token punctuation">:</span> ROUND_ROBIN       <span class="token comment"># 负载均衡策略为 ROUND_ROBIN，轮询方式分配请求</span>
    <span class="token key atrule">load_assignment</span><span class="token punctuation">:</span>
      <span class="token key atrule">cluster_name</span><span class="token punctuation">:</span> backend_app<span class="token punctuation">-</span>v20  <span class="token comment"># 负载分配集群的名称</span>
      <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">lb_endpoints</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
            <span class="token key atrule">address</span><span class="token punctuation">:</span>
              <span class="token key atrule">socket_address</span><span class="token punctuation">:</span>
                <span class="token key atrule">address</span><span class="token punctuation">:</span> 172.31.1.12 <span class="token comment"># 后端服务的 IP 地址</span>
                <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">8080</span>     <span class="token comment"># 后端服务的端口号</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>警告信息</p></div> <h2 id="响应报文的速率限制-response-rate-limit"><a href="#响应报文的速率限制-response-rate-limit" class="header-anchor">#</a> 响应报文的速率限制 (Response Rate Limit)</h2> <p>响应速率限制允许你控制响应的传输速率，模拟慢速网络等情况。</p> <h3 id="参数-3"><a href="#参数-3" class="header-anchor">#</a> 参数</h3> <h4 id="固定速率限制"><a href="#固定速率限制" class="header-anchor">#</a> 固定速率限制</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">fault</span><span class="token punctuation">:</span>
  <span class="token key atrule">response_rate_limit</span><span class="token punctuation">:</span>
    <span class="token key atrule">fixed_limit</span><span class="token punctuation">:</span>
      <span class="token comment"># 限制的传输速率，单位是字节/秒</span>
      <span class="token key atrule">bytes_per_second</span><span class="token punctuation">:</span> <span class="token number">1024</span>
    <span class="token key atrule">percentage</span><span class="token punctuation">:</span>
      <span class="token comment"># 应用速率限制的请求百分比 (0-100)</span>
      <span class="token key atrule">numerator</span><span class="token punctuation">:</span> <span class="token number">100</span>
      <span class="token key atrule">denominator</span><span class="token punctuation">:</span> HUNDRED
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>参数说明：</strong></p> <ul><li><code>fixed_limit</code>: 指定固定的传输速率，以字节/秒为单位。
<ul><li><code>bytes_per_second</code>: 每秒传输的字节数。</li></ul></li> <li><code>percentage</code>: 指定应应用速率限制的请求百分比。
<ul><li><code>numerator</code>: 速率限制应用比例的分子。</li> <li><code>denominator</code>: 速率限制应用比例的分母。可以是<code>HUNDRED</code>（100），<code>TEN_THOUSAND</code>（10000），或<code>MILLION</code>（1000000）。</li></ul></li></ul> <h4 id="头部速率限制"><a href="#头部速率限制" class="header-anchor">#</a> 头部速率限制</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">fault</span><span class="token punctuation">:</span>
  <span class="token key atrule">response_rate_limit</span><span class="token punctuation">:</span>
    <span class="token key atrule">header_limit</span><span class="token punctuation">:</span>
      <span class="token key atrule">header_name</span><span class="token punctuation">:</span> <span class="token string">&quot;x-envoy-fault-rate-limit&quot;</span>
    <span class="token key atrule">percentage</span><span class="token punctuation">:</span>
      <span class="token key atrule">numerator</span><span class="token punctuation">:</span> <span class="token number">100</span>
      <span class="token key atrule">denominator</span><span class="token punctuation">:</span> HUNDRED
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>参数说明：</strong></p> <ul><li><code>header_limit</code>: 根据请求头中的速率限制值来设置传输速率。
<ul><li><code>header_name</code>: 请求头的名称，值为速率限制，以字节/秒为单位。</li></ul></li> <li><code>percentage</code>: 指定应应用速率限制的请求百分比。
<ul><li><code>numerator</code>: 速率限制应用比例的分子。</li> <li><code>denominator</code>: 速率限制应用比例的分母。可以是<code>HUNDRED</code>（100），<code>TEN_THOUSAND</code>（10000），或<code>MILLION</code>（1000000）。</li></ul></li></ul> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p>zheshixinxi</p></div> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token number">123</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=envoy" title="标签">#envoy</a></div> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2024/08/06, 16:32:56</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/cloud-native/envoy/" class="page-nav-centre page-nav-centre-prev router-link-active"><div class="tooltip">envoy</div></a> <a href="/cloud-native/envoy/20240804001641/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">test</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/cloud-native/envoy/" class="prev router-link-active">envoy</a></span> <span class="next"><a href="/cloud-native/envoy/20240804001641/">test</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/cloud-native/envoy/20240804001732/"><div>
            test
            <!----></div></a> <span class="date">08-04</span></dt></dl><dl><dd>02</dd> <dt><a href="/cloud-native/envoy/20240804001722/"><div>
            test
            <!----></div></a> <span class="date">08-04</span></dt></dl><dl><dd>03</dd> <dt><a href="/cloud-native/envoy/20240804001703/"><div>
            test
            <!----></div></a> <span class="date">08-04</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/yanshicheng" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/yanshicheng" title="Gitee" target="_blank" class="iconfont icon-gitee"></a><a href="https://www.yanshicheng.com" title="网站首页" target="_blank" class="iconfont icon-rss"></a><a href="https://www.yanshicheng.cn/?contact=true" title="联系我" target="_blank" class="iconfont icon-youjian"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2024
    <span>闫世成  | blog<br> <a href="http://beian.miit.gov.cn/" target="_blank">京ICP备16013810号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div><div></div><!----></div></div>
    <script src="/assets/js/app.4d013cf5.js" defer></script><script src="/assets/js/2.3e576c84.js" defer></script><script src="/assets/js/41.065fd559.js" defer></script><script src="/assets/js/15.2849772b.js" defer></script><script src="/assets/js/7.5f97d280.js" defer></script>
  </body>
</html>

(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{404:function(t,s,a){"use strict";a.r(s);var n=a(4),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[t._v("#")]),t._v(" 概念")]),t._v(" "),s("h3",{attrs:{id:"服务韧性-service-resilience"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务韧性-service-resilience"}},[t._v("#")]),t._v(" 服务韧性（Service Resilience）")]),t._v(" "),s("p",[t._v("服务韧性是指系统在面对各种故障、压力和变化时保持功能和性能的能力。它强调系统能够优雅地处理失败，快速恢复，并持续提供服务。")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("容错能力")]),t._v("：能够在部分组件失败的情况下继续运行。")]),t._v(" "),s("li",[s("code",[t._v("自我修复")]),t._v("：自动检测并修复故障。")]),t._v(" "),s("li",[s("code",[t._v("负载均衡")]),t._v("：有效分配资源和请求。")]),t._v(" "),s("li",[s("code",[t._v("优雅降级")]),t._v("：在资源不足时，保证核心功能运行。")]),t._v(" "),s("li",[s("code",[t._v("快速恢复")]),t._v("：从故障中迅速恢复正常状态。\n实现方法")])]),t._v(" "),s("ul",[s("li",[t._v("采用微服务架构，实现服务隔离。")]),t._v(" "),s("li",[t._v("使用断路器模式，防止级联故障。")]),t._v(" "),s("li",[t._v("实施重试机制和超时控制。")]),t._v(" "),s("li",[t._v("采用异步通信，减少服务间依赖。")]),t._v(" "),s("li",[t._v("实现服务发现和动态路由。\n在现代复杂的分布式系统中，服务韧性对于保证系统的可用性和可靠性至关重要，尤其在面对不可预知的故障和压力时。")])]),t._v(" "),s("h3",{attrs:{id:"混沌工程-chaos-engineering"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#混沌工程-chaos-engineering"}},[t._v("#")]),t._v(" 混沌工程（Chaos Engineering）")]),t._v(" "),s("p",[t._v("混沌工程是一种通过主动引入故障和异常情况来识别系统弱点的实践方法。它旨在提高系统的可靠性和韧性。\n对于架构师: 验证系统架构的容错能力，比如验证现在提倡的面向失败设计的系统。\n对于开发和运维: 提高故障的应急效率， 实现故障告警，定位，恢复的有效和高效性。\n对于测试: 弥补传统测试方法留下的空白，混沌功能从系统的角度进行测试，降低故障复发率，这有别与传统测试方法从用户角度的进行测试。\n对于产品和设计: 通过混沌事件查看产品的表现，提高客户使用体验。")]),t._v(" "),s("ol",[s("li",[t._v("建立稳态假设：定义系统正常运行的基准。")]),t._v(" "),s("li",[t._v("构建假设：假设在特定故障情况下系统的行为。")]),t._v(" "),s("li",[t._v("设计实验：设计和执行能验证或推翻假设的实验。")]),t._v(" "),s("li",[t._v("验证结果：分析实验结果，改进系统。")]),t._v(" "),s("li",[t._v("自动化：将混沌实验自动化，作为持续测试的一部分。\n实施步骤")]),t._v(" "),s("li",[t._v("从小规模开始，逐步增加实验复杂度。")]),t._v(" "),s("li",[t._v("在非生产环境中进行初步测试。")]),t._v(" "),s("li",[t._v("谨慎地在生产环境中执行实验。")]),t._v(" "),s("li",[t._v("持续监控和分析系统行为。")]),t._v(" "),s("li",[t._v("根据实验结果改进系统设计和架构。\n工具和平台")])]),t._v(" "),s("ul",[s("li",[t._v("Netflix Chaos Monkey")]),t._v(" "),s("li",[t._v("Gremlin")]),t._v(" "),s("li",[t._v("Chaos Toolkit")]),t._v(" "),s("li",[t._v("AWS Fault Injection Simulator\n优势")]),t._v(" "),s("li",[t._v("提前发现系统弱点。")]),t._v(" "),s("li",[t._v("增强团队对系统行为的理解。")]),t._v(" "),s("li",[t._v("提高系统整体可靠性和韧性。")]),t._v(" "),s("li",[t._v("培养团队的事故应对能力。")])]),t._v(" "),s("h3",{attrs:{id:"故障注入-fault-injection"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#故障注入-fault-injection"}},[t._v("#")]),t._v(" 故障注入（Fault Injection）")]),t._v(" "),s("p",[t._v("故障注入是一种有意引入错误、延迟或异常行为到系统中的技术，用于测试系统的容错能力和行为。\n主要类型")]),t._v(" "),s("ol",[s("li",[t._v("网络故障：延迟、丢包、断连。")]),t._v(" "),s("li",[t._v("资源耗尽：CPU、内存、磁盘空间耗尽。")]),t._v(" "),s("li",[t._v("服务故障："),s("code",[t._v("服务崩溃")]),t._v("、响应错误。")]),t._v(" "),s("li",[t._v("数据故障：数据损坏、不一致。\n实现方法")]),t._v(" "),s("li",[t._v("代码级注入：在应用代码中添加故障触发点。")]),t._v(" "),s("li",[t._v("网络层注入：使用代理或防火墙规则模拟网络问题。")]),t._v(" "),s("li",[t._v("容器层注入：在容器运行时注入故障。")]),t._v(" "),s("li",[t._v("基础设施层注入：在虚拟机或物理机层面注入故障。\n工具")])]),t._v(" "),s("ul",[s("li",[t._v("Istio 故障注入功能")]),t._v(" "),s("li",[t._v("Chaos Mesh")]),t._v(" "),s("li",[t._v("Pumba (针对Docker容器)")]),t._v(" "),s("li",[t._v("Toxiproxy（网络故障模拟）\n最佳实践")])]),t._v(" "),s("ol",[s("li",[t._v("从简单故障开始，逐步增加复杂度。")]),t._v(" "),s("li",[t._v("结合监控系统，全面观察系统行为。")]),t._v(" "),s("li",[t._v("在测试环境充分验证后再考虑生产环境。")]),t._v(" "),s("li",[t._v("制定明确的回滚计划。")]),t._v(" "),s("li",[t._v("记录和分析每次故障注入的结果。\n与混沌工程的关系\n故障注入是混沌工程的一个重要工具。混沌工程使用故障注入作为一种手段来执行实验，但混沌工程还包括更广泛的策略和方法论。")])]),t._v(" "),s("h3",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("p",[t._v("这三个概念紧密相关，共同致力于提高系统的可靠性和韧性：")]),t._v(" "),s("ul",[s("li",[t._v("服务韧性是目标，它定义了我们希望系统具备的特性。")]),t._v(" "),s("li",[t._v("混沌工程是一种方法论，用于系统地提高和验证服务韧性。")]),t._v(" "),s("li",[t._v("故障注入是一种具体技术，是实现混沌工程和测试服务韧性的重要工具。")])]),t._v(" "),s("h4",{attrs:{id:"混沌工程和故障注入的概念与区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#混沌工程和故障注入的概念与区别"}},[t._v("#")]),t._v(" 混沌工程和故障注入的概念与区别")]),t._v(" "),s("ul",[s("li",[t._v("混沌工程是发现新信息的实验过程，而故障注入是对特定条件或变量的测试方法。")]),t._v(" "),s("li",[t._v("测试和实验有着重要区别：\n"),s("ul",[s("li",[t._v("测试只产生二元的结果（通过或失败），不能发掘系统未知或尚不明确的认知。")]),t._v(" "),s("li",[t._v("实验可以产生新的认知，通常能够开辟出更广泛的对复杂系统的认知空间。")])])]),t._v(" "),s("li",[t._v("混沌工程不仅仅是制造服务中断等故障：\n"),s("ul",[s("li",[t._v("并不是所有实验都可以有建设性、高效地发现问题。")]),t._v(" "),s("li",[t._v("除了故障类场景，还存在非故障类场景，如流量激增、资源竞争、拜占庭故障等。")])])])]),t._v(" "),s("ol",[s("li",[t._v("流量激增")])]),t._v(" "),s("ul",[s("li",[t._v("定义：指在短时间内系统请求量急剧增加的情况。")]),t._v(" "),s("li",[t._v("原因：可能由于突发事件、营销活动、病毒式传播等引起。")]),t._v(" "),s("li",[t._v("影响：\n"),s("ul",[s("li",[t._v("可能导致系统过载，响应时间增加。")]),t._v(" "),s("li",[t._v("可能触发自动扩展机制，增加资源消耗和成本。")]),t._v(" "),s("li",[t._v("可能导致缓存失效，增加后端数据库压力。")])])]),t._v(" "),s("li",[t._v("测试方法：\n"),s("ul",[s("li",[t._v("使用负载测试工具模拟突发流量。")]),t._v(" "),s("li",[t._v("逐步增加流量，观察系统的扩展能力和性能变化。")]),t._v(" "),s("li",[t._v("模拟不同类型的请求组合，如读密集型vs写密集型。")])])])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("资源竞争")])]),t._v(" "),s("ul",[s("li",[t._v("定义：多个进程或线程同时争夺有限的系统资源。")]),t._v(" "),s("li",[t._v("常见资源：CPU、内存、磁盘I/O、网络带宽、数据库连接等。")]),t._v(" "),s("li",[t._v("影响：\n"),s("ul",[s("li",[t._v("可能导致系统响应变慢。")]),t._v(" "),s("li",[t._v("可能引发死锁或饥饿状态。")]),t._v(" "),s("li",[t._v("可能造成某些任务长时间无法完成。")])])]),t._v(" "),s("li",[t._v("测试方法：\n"),s("ul",[s("li",[t._v("人为创造资源紧张状况，如启动大量计算密集型任务。")]),t._v(" "),s("li",[t._v("模拟数据库连接池耗尽的情况。")]),t._v(" "),s("li",[t._v("创造多个服务同时大量读写共享资源的场景。")])])])]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("拜占庭故障")])]),t._v(" "),s("ul",[s("li",[t._v("定义：系统中的某个组件表现不一致，对不同的观察者呈现不同的症状。")]),t._v(" "),s("li",[t._v("特点：这类故障难以检测，因为故障组件可能看似正常运行。")]),t._v(" "),s("li",[t._v("影响：\n"),s("ul",[s("li",[t._v("可能导致系统行为不一致。")]),t._v(" "),s("li",[t._v("可能引发数据不一致或损坏。")]),t._v(" "),s("li",[t._v("在分布式系统中尤其危险，可能导致共识算法失效。")])])]),t._v(" "),s("li",[t._v("测试方法：\n"),s("ul",[s("li",[t._v("模拟节点发送矛盾的信息给不同的接收者。")]),t._v(" "),s("li",[t._v("创造某个服务在不同调用中返回不一致结果的情况。")]),t._v(" "),s("li",[t._v("在分布式系统中注入时钟偏移，导致时序问题。")])])])]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("其他非故障类场景")])]),t._v(" "),s("ul",[s("li",[t._v("数据倾斜：在分布式系统中，数据或工作负载不均匀分布。\n"),s("ul",[s("li",[t._v("测试方法：创造热点数据，观察系统如何处理不均衡的负载。")])])]),t._v(" "),s("li",[t._v("配置漂移：系统配置随时间逐渐偏离预期状态。\n"),s("ul",[s("li",[t._v("测试方法：模拟配置文件被意外修改或不同步的情况。")])])]),t._v(" "),s("li",[t._v("依赖服务降级：外部服务性能下降但未完全失效。\n"),s("ul",[s("li",[t._v("测试方法：降低模拟外部服务的响应速度，观察系统反应。")])])])]),t._v(" "),s("h4",{attrs:{id:"混沌工程实验的输入样例-扩展"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#混沌工程实验的输入样例-扩展"}},[t._v("#")]),t._v(" 混沌工程实验的输入样例（扩展）")]),t._v(" "),s("ul",[s("li",[t._v("模拟整个云服务区域或整个数据中心故障")]),t._v(" "),s("li",[t._v("跨多实例删除部分Kafka topic来重现生产环境中发生过的问题")]),t._v(" "),s("li",[t._v("挑选特定时间段和流量，对其涉及的服务间调用注入特定的延时")]),t._v(" "),s("li",[t._v("方法级别的混乱（运行时注入）：让方法随机抛出各种异常")]),t._v(" "),s("li",[t._v("在代码中插入指令，允许在这些指令之前运行故障注入")]),t._v(" "),s("li",[t._v("强制系统节点间的时间不同步")]),t._v(" "),s("li",[t._v("在驱动程序中执行模拟I/O错误的程序")]),t._v(" "),s("li",[t._v("让某个Elasticsearch集群CPU超负荷")])]),t._v(" "),s("h4",{attrs:{id:"故障注入的具体样例-扩展"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#故障注入的具体样例-扩展"}},[t._v("#")]),t._v(" 故障注入的具体样例（扩展）")]),t._v(" "),s("ul",[s("li",[t._v("CPU高负载")]),t._v(" "),s("li",[t._v("磁盘高负载：频繁读写磁盘")]),t._v(" "),s("li",[t._v("磁盘空间不足")]),t._v(" "),s("li",[t._v("优雅的下线应用：使用应用的stop脚本平滑地停止应用")]),t._v(" "),s("li",[t._v("通过kill进程直接停止应用，可能造成数据不一致")]),t._v(" "),s("li",[t._v("网络恶化：随机改变一些包数据，使数据内容不正确")]),t._v(" "),s("li",[t._v("网络延迟：将包延迟一个特定范围的时间")]),t._v(" "),s("li",[t._v("网络丢包：构造一个tcp不会完全失败的丢包率")]),t._v(" "),s("li",[t._v("网络黑洞：忽略来自某个ip的包")]),t._v(" "),s("li",[t._v("外部服务不可达：将外部服务的域名指向本地环回地址或将访问外部服务的端口的OUTPUT数据包丢弃")])]),t._v(" "),s("h3",{attrs:{id:"envoy-http-故障注入过滤器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#envoy-http-故障注入过滤器"}},[t._v("#")]),t._v(" Envoy Http 故障注入过滤器")]),t._v(" "),s("p",[t._v("故障注入在 Envoy 中的实现上类似于重定向，重写，重试，他们通过修改 HTTP 请求或者应答的内容完成，")]),t._v(" "),s("ul",[s("li",[t._v("它由专用的故障注入过滤器(fault.injection)实现，用于测试微服务对不通形式的故障韧性")]),t._v(" "),s("li",[t._v("他通过用户指定的错误代码注入延迟(delay)和请求终止(abort),从而模拟出分阶段的不同故障情形。")]),t._v(" "),s("li",[t._v("故障范围仅限于通过网络及性能通信的的应用程序可观察到的范围，不支持模拟本地主机上的CPU和磁盘故障。")])]),t._v(" "),s("h3",{attrs:{id:"envoy-局部故障处理机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#envoy-局部故障处理机制"}},[t._v("#")]),t._v(" envoy 局部故障处理机制")]),t._v(" "),s("h4",{attrs:{id:"重试-retry"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重试-retry"}},[t._v("#")]),t._v(" 重试 (Retry)")]),t._v(" "),s("p",[t._v("分布式环境中对远程资源和服务的调用可能会由于"),s("strong",[t._v("瞬态故障")]),t._v("（短时间内可自行恢复的故障）而失败。一般情况下，重试机制可以解决此类问题。")]),t._v(" "),s("ul",[s("li",[t._v("常见的瞬态故障有网络连接速度慢、超时、资源过量使用或暂时不可用等。")]),t._v(" "),s("li",[t._v("envoy 可以配置超时 (Timeout)来快速失败，可以不让请求阻塞在故障后端上，而是 envoy 发起重试机制，把请求转移到后端其他端点，最终取决于会话绑定等机制。")])]),t._v(" "),s("h4",{attrs:{id:"超时-timeout"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#超时-timeout"}},[t._v("#")]),t._v(" 超时 (Timeout)")]),t._v(" "),s("p",[t._v("此外，也存在因意外事件而导致故障，并且可能需要较长的时间才能恢复。")]),t._v(" "),s("ul",[s("li",[t._v("此类故障的严重性范围涵盖从部分连接中断到服务完全失败：\n"),s("ul",[s("li",[t._v("连续重试和长时间的等待对该类场景没有太大意义。")]),t._v(" "),s("li",[t._v("应用程序应迅速接受该操作已失败并主动地应对该失败。")])])]),t._v(" "),s("li",[t._v("可以将调用服务的操作配置为实施“超时”，若该服务在超时内未能响应，则以失败消息响应：\n"),s("ul",[s("li",[t._v("这样可以避免长时间等待导致的资源浪费和系统不稳定。")])])])]),t._v(" "),s("h4",{attrs:{id:"断路器-circuit-breaker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#断路器-circuit-breaker"}},[t._v("#")]),t._v(" 断路器 (Circuit Breaker)")]),t._v(" "),s("p",[t._v("还有，若服务非常繁忙，则系统某一部分的故障可能会导致集联故障，简单的超时策略可能导致对同一操作的许多并发请求被阻止，直到超时时长耗尽为止。")]),t._v(" "),s("ul",[s("li",[t._v("这些被阻止的请求可能包含关键的系统资源，例如内存、线程和数据库连接等：")]),t._v(" "),s("li",[t._v("这些资源的耗尽可能导致需要使用相关资源的系统其他可能不相关的部分出现故障。")]),t._v(" "),s("li",[t._v("于是，此时最好立即使操作失败，并且仅在仅可能成功的情况下才尝试调用服务。")])]),t._v(" "),s("h2",{attrs:{id:"故障注入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#故障注入"}},[t._v("#")]),t._v(" 故障注入")]),t._v(" "),s("h3",{attrs:{id:"注入延迟-fault-injection-delay"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注入延迟-fault-injection-delay"}},[t._v("#")]),t._v(" 注入延迟 (Fault Injection Delay)")]),t._v(" "),s("h4",{attrs:{id:"参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参数"}},[t._v("#")]),t._v(" 参数")]),t._v(" "),s("p",[t._v("注入延迟允许你在请求处理之前人为地增加延迟，以模拟网络延迟或其他延迟情况。Envoy通过配置"),s("code",[t._v("fault")]),t._v("滤波器来实现这一功能。")]),t._v(" "),s("h4",{attrs:{id:"fixed-delay-固定延迟"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fixed-delay-固定延迟"}},[t._v("#")]),t._v(" Fixed Delay (固定延迟)")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http_filters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 HTTP 故障注入过滤器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envoy.filters.http.fault\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("typed_config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"@type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" type.googleapis.com/envoy.extensions.filters.http.fault.v3.HTTPFault\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("delay")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fixed_delay")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 固定延迟时间，可以是秒或毫秒")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("seconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或者使用 milliseconds 参数")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("milliseconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("percentage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 应用延迟的请求百分比 (0-100)")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("numerator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("denominator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HUNDRED\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br")])]),s("p",[s("strong",[t._v("参数说明：")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("fixed_delay")]),t._v(": 指定固定的延迟时间，可以使用"),s("code",[t._v("seconds")]),t._v("（秒）或"),s("code",[t._v("milliseconds")]),t._v("（毫秒）。这两个参数不能同时使用。\n"),s("ul",[s("li",[s("code",[t._v("seconds")]),t._v(": 延迟时间，以秒为单位。")]),t._v(" "),s("li",[s("code",[t._v("milliseconds")]),t._v(": 延迟时间，以毫秒为单位。")])])]),t._v(" "),s("li",[s("code",[t._v("percentage")]),t._v(": 指定应应用延迟的请求百分比，用于控制延迟故障注入的概率。\n"),s("ul",[s("li",[s("code",[t._v("numerator")]),t._v(": 延迟应用比例的分子。")]),t._v(" "),s("li",[s("code",[t._v("denominator")]),t._v(": 延迟应用比例的分母。可以是"),s("code",[t._v("HUNDRED")]),t._v("（100），"),s("code",[t._v("TEN_THOUSAND")]),t._v("（10000），或"),s("code",[t._v("MILLION")]),t._v("（1000000）。")])])])]),t._v(" "),s("h4",{attrs:{id:"header-delay-头部延迟"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#header-delay-头部延迟"}},[t._v("#")]),t._v(" Header Delay (头部延迟)")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http_filters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 HTTP 故障注入过滤器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 HTTP 故障注入过滤器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envoy.filters.http.fault\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("typed_config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"@type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" type.googleapis.com/envoy.extensions.filters.http.fault.v3.HTTPFault\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("delay")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用请求头中的延迟值")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("header_delay")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("header_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"x-envoy-fault-delay-request"')]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定用于延迟的请求头名称")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("percentage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 应用延迟的请求百分比 (0-100)")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("numerator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 延迟应用于 100% 的请求")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("denominator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HUNDRED  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分母表示 100，即百分比基数")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br")])]),s("p",[s("strong",[t._v("参数说明：")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("header_delay")]),t._v(": 根据请求头中的延迟值来设置延迟。\n"),s("ul",[s("li",[s("code",[t._v("header_name")]),t._v(": 请求头的名称，值为延迟时间，单位为毫秒。")])])]),t._v(" "),s("li",[s("code",[t._v("percentage")]),t._v(": 指定应应用延迟的请求百分比，用于控制延迟故障注入的概率。\n"),s("ul",[s("li",[s("code",[t._v("numerator")]),t._v(": 延迟应用比例的分子。")]),t._v(" "),s("li",[s("code",[t._v("denominator")]),t._v(": 延迟应用比例的分母。可以是"),s("code",[t._v("HUNDRED")]),t._v("（100），"),s("code",[t._v("TEN_THOUSAND")]),t._v("（10000），或"),s("code",[t._v("MILLION")]),t._v("（1000000）。")])])])]),t._v(" "),s("h3",{attrs:{id:"注入请求终止-fault-injection-abort"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注入请求终止-fault-injection-abort"}},[t._v("#")]),t._v(" 注入请求终止 (Fault Injection Abort)")]),t._v(" "),s("p",[t._v("Envoy支持通过"),s("code",[t._v("fault")]),t._v("滤波器注入请求终止，以模拟服务器错误或其他终止条件。")]),t._v(" "),s("h4",{attrs:{id:"参数-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参数-2"}},[t._v("#")]),t._v(" 参数")]),t._v(" "),s("h4",{attrs:{id:"固定http状态码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#固定http状态码"}},[t._v("#")]),t._v(" 固定HTTP状态码")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http_filters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 HTTP 故障注入过滤器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envoy.filters.http.fault\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("typed_config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"@type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" type.googleapis.com/envoy.extensions.filters.http.fault.v3.HTTPFault\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("abort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http_status")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 终止请求返回的 HTTP 状态码")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("percentage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 应用终止的请求百分比 (0-100)")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("numerator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 终止应用于 100% 的请求")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("denominator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HUNDRED  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分母表示 100，即百分比基数>)")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("p",[s("strong",[t._v("参数说明：")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("http_status")]),t._v(": 指定返回的HTTP状态码。\n"),s("ul",[s("li",[s("code",[t._v("code")]),t._v(": 返回的HTTP状态码（如503表示服务不可用）。")])])]),t._v(" "),s("li",[s("code",[t._v("percentage")]),t._v(": 指定应应用终止的请求百分比。\n"),s("ul",[s("li",[s("code",[t._v("numerator")]),t._v(": 终止应用比例的分子。")]),t._v(" "),s("li",[s("code",[t._v("denominator")]),t._v(": 终止应用比例的分母。可以是"),s("code",[t._v("HUNDRED")]),t._v("（100），"),s("code",[t._v("TEN_THOUSAND")]),t._v("（10000），或"),s("code",[t._v("MILLION")]),t._v("（1000000）。")])])])]),t._v(" "),s("h4",{attrs:{id:"grpc状态码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#grpc状态码"}},[t._v("#")]),t._v(" gRPC状态码")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http_filters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 HTTP 过滤器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envoy.filters.http.fault\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("typed_config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"@type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" type.googleapis.com/envoy.extensions.filters.http.fault.v3.HTTPFault\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("abort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("grpc_status")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 终止请求返回的gRPC状态码")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("status")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" UNAVAILABLE  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置 gRPC 状态码为 UNAVAILABLE")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("percentage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 应用终止的请求百分比 (0-100)")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("numerator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 终止应用于 100% 的请求")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("denominator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HUNDRED  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分母表示 100，即百分比基数")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("p",[s("strong",[t._v("参数说明：")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("grpc_status")]),t._v(": 指定返回的gRPC状态码。\n"),s("ul",[s("li",[s("code",[t._v("status")]),t._v(": 返回的gRPC状态码（如"),s("code",[t._v("UNAVAILABLE")]),t._v("）。")])])]),t._v(" "),s("li",[s("code",[t._v("percentage")]),t._v(": 指定应应用终止的请求百分比。\n"),s("ul",[s("li",[s("code",[t._v("numerator")]),t._v(": 终止应用比例的分子。")]),t._v(" "),s("li",[s("code",[t._v("denominator")]),t._v(": 终止应用比例的分母。可以是"),s("code",[t._v("HUNDRED")]),t._v("（100），"),s("code",[t._v("TEN_THOUSAND")]),t._v("（10000），或"),s("code",[t._v("MILLION")]),t._v("（1000000）。")])])])]),t._v(" "),s("h4",{attrs:{id:"头部终止条件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#头部终止条件"}},[t._v("#")]),t._v(" 头部终止条件")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http_filters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 HTTP 过滤器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envoy.filters.http.fault\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("typed_config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"@type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" type.googleapis.com/envoy.extensions.filters.http.fault.v3.HTTPFault\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("abort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("header_abort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("header_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"x-envoy-fault-abort-request"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 用于指定触发请求中止的 HTTP 头名称")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[s("strong",[t._v("参数说明：")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("header_abort")]),t._v(": 根据请求头中的终止条件来终止请求。\n"),s("ul",[s("li",[s("code",[t._v("header_name")]),t._v(": 请求头的名称，值为终止条件（如HTTP状态码）。")])])])]),t._v(" "),s("h4",{attrs:{id:"配置示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置示例"}},[t._v("#")]),t._v(" 配置示例")]),t._v(" "),s("p",[t._v("最大同时注入故障数量: 100。\n注入故障返回 HTTP 状态码 503。\n10%的请求注入故障 (percentage: numerator: 10, denominator: HUNDRED)。")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("profile_path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /tmp/envoy.prof  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置 Envoy 管理接口的性能分析文件路径，用于存储性能分析数据")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("access_log_path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /dev/stdout   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置 Envoy 管理接口的访问日志路径，这里设置为标准输出")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("socket_address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0.0.0.0           "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置管理接口的监听地址，0.0.0.0 表示监听所有网络接口")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port_value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9901")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 管理接口的监听端口号，这里设置为 9901")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("layered_runtime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("layers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin_layer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("              "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 管理层的运行时配置，可以通过此层动态更新配置，便于管理")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("listeners")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" listener_0\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("socket_address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0.0.0.0         "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置监听器的监听地址，0.0.0.0 表示监听所有网络接口")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port_value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监听器的端口号，这里设置为 80，表示 HTTP 默认端口")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filter_chains")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envoy.filters.network.http_connection_manager\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("typed_config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"@type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stat_prefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ingress_http     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置统计前缀，用于标识该 HTTP 连接管理器的统计信息")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("codec_type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" AUTO              "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 自动选择 HTTP 编解码类型，可以是 HTTP1 或 HTTP2")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route_config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" local_route           "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 路由配置的名称")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("virtual_hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" backend_app         "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 虚拟主机的名称")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("domains")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 该虚拟主机匹配的域名，* 表示匹配所有域名")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),t._v("           "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 路由匹配的前缀路径，这里匹配所有路径")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" backend_app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v10   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请求将路由到名为 backend_app-v10 的集群")]),t._v("\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0.25s        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请求超时时间设置为 0.25 秒")]),t._v("\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("request_mirror_policies")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请求镜像策略")]),t._v("\n                  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" backend_app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v20  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将请求镜像到 backend_app-v20 集群")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runtime_fraction")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default_value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("numerator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("denominator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HUNDRED  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 20%的请求将被镜像")]),t._v("\n                      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runtime_key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"routing.request_mirror.backend_app"')]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 运行时配置键，可以动态调整镜像比例")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http_filters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envoy.filters.http.fault\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("typed_config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"@type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" type.googleapis.com/envoy.extensions.filters.http.fault.v3.HTTPFault\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max_active_faults")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 最大同时注入的故障数量")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("abort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http_status")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定返回的 HTTP 状态码，这里设置为 503，表示服务不可用")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("percentage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("numerator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注入故障的请求百分比，分子部分，表示 10%")]),t._v("\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("denominator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HUNDRED "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注入故障的请求百分比，分母部分，表示 100")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envoy.filters.http.router\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("typed_config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"@type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" type.googleapis.com/envoy.extensions.filters.http.router.v3.Router  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 HTTP 路由过滤器")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("clusters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" backend_app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v10\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("connect_timeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0.25s       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置连接超时时间为 0.25 秒")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" STRICT_DNS             "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 集群类型为 STRICT_DNS，严格的 DNS 模式，会动态解析 DNS 并更新端点")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lb_policy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ROUND_ROBIN       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 负载均衡策略为 ROUND_ROBIN，轮询方式分配请求")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("load_assignment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" backend_app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v10  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 负载分配集群的名称")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoints")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lb_endpoints")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("socket_address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.31.1.11 "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 后端服务的 IP 地址")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port_value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 后端服务的端口号")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" backend_app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v20\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("connect_timeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0.25s       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置连接超时时间为 0.25 秒")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" STRICT_DNS             "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 集群类型为 STRICT_DNS，严格的 DNS 模式，会动态解析 DNS 并更新端点")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lb_policy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ROUND_ROBIN       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 负载均衡策略为 ROUND_ROBIN，轮询方式分配请求")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("load_assignment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" backend_app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v20  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 负载分配集群的名称")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoints")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lb_endpoints")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("socket_address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.31.1.12 "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 后端服务的 IP 地址")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port_value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 后端服务的端口号")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br"),s("span",{staticClass:"line-number"},[t._v("48")]),s("br"),s("span",{staticClass:"line-number"},[t._v("49")]),s("br"),s("span",{staticClass:"line-number"},[t._v("50")]),s("br"),s("span",{staticClass:"line-number"},[t._v("51")]),s("br"),s("span",{staticClass:"line-number"},[t._v("52")]),s("br"),s("span",{staticClass:"line-number"},[t._v("53")]),s("br"),s("span",{staticClass:"line-number"},[t._v("54")]),s("br"),s("span",{staticClass:"line-number"},[t._v("55")]),s("br"),s("span",{staticClass:"line-number"},[t._v("56")]),s("br"),s("span",{staticClass:"line-number"},[t._v("57")]),s("br"),s("span",{staticClass:"line-number"},[t._v("58")]),s("br"),s("span",{staticClass:"line-number"},[t._v("59")]),s("br"),s("span",{staticClass:"line-number"},[t._v("60")]),s("br"),s("span",{staticClass:"line-number"},[t._v("61")]),s("br"),s("span",{staticClass:"line-number"},[t._v("62")]),s("br"),s("span",{staticClass:"line-number"},[t._v("63")]),s("br"),s("span",{staticClass:"line-number"},[t._v("64")]),s("br"),s("span",{staticClass:"line-number"},[t._v("65")]),s("br"),s("span",{staticClass:"line-number"},[t._v("66")]),s("br"),s("span",{staticClass:"line-number"},[t._v("67")]),s("br"),s("span",{staticClass:"line-number"},[t._v("68")]),s("br"),s("span",{staticClass:"line-number"},[t._v("69")]),s("br"),s("span",{staticClass:"line-number"},[t._v("70")]),s("br"),s("span",{staticClass:"line-number"},[t._v("71")]),s("br"),s("span",{staticClass:"line-number"},[t._v("72")]),s("br"),s("span",{staticClass:"line-number"},[t._v("73")]),s("br"),s("span",{staticClass:"line-number"},[t._v("74")]),s("br"),s("span",{staticClass:"line-number"},[t._v("75")]),s("br"),s("span",{staticClass:"line-number"},[t._v("76")]),s("br"),s("span",{staticClass:"line-number"},[t._v("77")]),s("br"),s("span",{staticClass:"line-number"},[t._v("78")]),s("br"),s("span",{staticClass:"line-number"},[t._v("79")]),s("br"),s("span",{staticClass:"line-number"},[t._v("80")]),s("br"),s("span",{staticClass:"line-number"},[t._v("81")]),s("br"),s("span",{staticClass:"line-number"},[t._v("82")]),s("br"),s("span",{staticClass:"line-number"},[t._v("83")]),s("br"),s("span",{staticClass:"line-number"},[t._v("84")]),s("br"),s("span",{staticClass:"line-number"},[t._v("85")]),s("br"),s("span",{staticClass:"line-number"},[t._v("86")]),s("br")])]),s("h3",{attrs:{id:"响应报文的速率限制-response-rate-limit"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#响应报文的速率限制-response-rate-limit"}},[t._v("#")]),t._v(" 响应报文的速率限制 (Response Rate Limit)")]),t._v(" "),s("p",[t._v("响应速率限制允许你控制响应的传输速率，模拟慢速网络等情况。")]),t._v(" "),s("h4",{attrs:{id:"参数-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参数-3"}},[t._v("#")]),t._v(" 参数")]),t._v(" "),s("h4",{attrs:{id:"固定速率限制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#固定速率限制"}},[t._v("#")]),t._v(" 固定速率限制")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http_filters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 HTTP 过滤器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envoy.filters.http.fault\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("typed_config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"@type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" type.googleapis.com/envoy.extensions.filters.http.fault.v3.HTTPFault\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("response_rate_limit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置响应速率限制")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fixed_limit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bytes_per_second")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 限制的传输速率，单位是字节/秒")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("percentage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("numerator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 应用速率限制的请求百分比 (0-100)，即速率限制应用于多少比例的请求")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("denominator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HUNDRED "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分母，表示百分比的分母，此处使用 HUNDRED 表示百分比")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("p",[s("strong",[t._v("参数说明：")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("fixed_limit")]),t._v(": 指定固定的传输速率，以字节/秒为单位。\n"),s("ul",[s("li",[s("code",[t._v("bytes_per_second")]),t._v(": 每秒传输的字节数。")])])]),t._v(" "),s("li",[s("code",[t._v("percentage")]),t._v(": 指定应应用速率限制的请求百分比。\n"),s("ul",[s("li",[s("code",[t._v("numerator")]),t._v(": 速率限制应用比例的分子。")]),t._v(" "),s("li",[s("code",[t._v("denominator")]),t._v(": 速率限制应用比例的分母。可以是"),s("code",[t._v("HUNDRED")]),t._v("（100），"),s("code",[t._v("TEN_THOUSAND")]),t._v("（10000），或"),s("code",[t._v("MILLION")]),t._v("（1000000）。")])])])]),t._v(" "),s("h4",{attrs:{id:"头部速率限制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#头部速率限制"}},[t._v("#")]),t._v(" 头部速率限制")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http_filters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 HTTP 过滤器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envoy.filters.http.fault "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 过滤器名称")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("typed_config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"@type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" type.googleapis.com/envoy.extensions.filters.http.fault.v3.HTTPFault\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("response_rate_limit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置响应速率限制")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("header_limit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("header_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"x-envoy-fault-rate-limit"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 用于指定触发响应速率限制的 HTTP 头名称")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("percentage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("numerator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 应用速率限制的请求百分比 (0-100)，即速率限制应用于多少比例的请求")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("denominator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HUNDRED "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分母，表示百分比的分母，此处使用 HUNDRED 表示百分比")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("p",[s("strong",[t._v("参数说明：")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("header_limit")]),t._v(": 根据请求头中的速率限制值来设置传输速率。\n"),s("ul",[s("li",[s("code",[t._v("header_name")]),t._v(": 请求头的名称，值为速率限制，以字节/秒为单位。")])])]),t._v(" "),s("li",[s("code",[t._v("percentage")]),t._v(": 指定应应用速率限制的请求百分比。\n"),s("ul",[s("li",[s("code",[t._v("numerator")]),t._v(": 速率限制应用比例的分子。")]),t._v(" "),s("li",[s("code",[t._v("denominator")]),t._v(": 速率限制应用比例的分母。可以是"),s("code",[t._v("HUNDRED")]),t._v("（100），"),s("code",[t._v("TEN_THOUSAND")]),t._v("（10000），或"),s("code",[t._v("MILLION")]),t._v("（1000000）。")])])])]),t._v(" "),s("h2",{attrs:{id:"重试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重试"}},[t._v("#")]),t._v(" 重试")]),t._v(" "),s("p",[t._v("常见的瞬态处理策略如下:")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("重试")]),t._v(": 对于暂时性或不常见类型的故障，反复请求通常可以获取正确结果。")]),t._v(" "),s("li",[s("strong",[t._v("延迟后重试")]),t._v(": 若故障时由常见的链接故障或者繁忙故障，通常需要一些时间纠正连接问题或清除积压工作，应用程序则应该等待适当的时间，然后重试请求。")]),t._v(" "),s("li",[s("strong",[t._v("取消")]),t._v(": 对于并非暂时性故障，或即便反复请求也不太能成功的故障，则应用程序应取消操作并报告异常。\n对于常见的瞬态故障，应合理设定重试之间的时间间隔，以简可能均匀的传播来自应用程序多个实例的请求，从而减少繁忙服务持续超载的机率。")]),t._v(" "),s("li",[t._v("显然，如果应用程序的许多实例因不断重试请求而服务不堪重负，则恢复该服务将花费更长的时间。\n可以在重试尝试之间增加延迟的方式重复此过程，直到尝试了最大数量的请求位置。")]),t._v(" "),s("li",[t._v("延迟可以增量或指数方式增加，具体取决于故障的类型，以及在此期间得到纠正的可能性。\n这张图片展示了一些有关重试的注意事项，下面是详细的解释：")])]),t._v(" "),s("h3",{attrs:{id:"注意事项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[t._v("#")]),t._v(" 注意事项:")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("重试策略需要匹配应用程序的业务需求和故障的性质，对于某些非关键操作，最好是快速失败而不是重试，以防止影响应用程序的吞吐量")]),t._v("：\n"),s("ul",[s("li",[t._v("对于交互式Web应用程序，在较短的延迟后进行少量重试，而后向用户显示适当的信息，例如“请稍后重试”。")]),t._v(" "),s("li",[t._v("对于批处理应用，增加重试次数可能会更合适，但重试次数之间的延迟应成倍或指数级增加。")])])]),t._v(" "),s("li",[s("strong",[t._v("若大量重试后请求仍然失败，最好防止进一步的请求进入同一服务，并立即报告失败")]),t._v("：\n"),s("ul",[s("li",[t._v("在一定的过期时长后，设置服务暂时允许一个或多个请求通过，以查看它们是否成功，这是断路器的功能。")])])]),t._v(" "),s("li",[s("strong",[t._v("还需要考虑操作幂等性与否")]),t._v("：\n"),s("ul",[s("li",[t._v("对于幂等性操作，重试本质上是安全的。")]),t._v(" "),s("li",[t._v("否则，重试可能导致该操作执行多次，并产生意外的副作用。")])])]),t._v(" "),s("li",[s("strong",[t._v("请求可能会由于多种原因而失败，它们可能分别会引发不同的异常，重试策略应根据异常的类型调整两次重试之间的时间间隔")]),t._v("：\n"),s("ul",[s("li",[t._v("有些异常可能是迅速可解决的故障。")]),t._v(" "),s("li",[t._v("有些异常则可能会持续更长时间。")])])]),t._v(" "),s("li",[s("strong",[t._v("确保所有重试代码已针对各种故障情况进行了全面测试，以检查它们是否不会严重影响应用程序的性能或可靠性，是否对服务和资源造成过多负担，是否产生竞争状况或瓶颈")]),t._v("。\n这张图片详细介绍了HTTP请求重试（route.RetryPolicy）的配置和注意事项，以下是具体内容的解释：")])]),t._v(" "),s("h3",{attrs:{id:"http请求重试-route-retrypolicy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http请求重试-route-retrypolicy"}},[t._v("#")]),t._v(" HTTP请求重试（route.RetryPolicy）")]),t._v(" "),s("h4",{attrs:{id:"envoy支持在虚拟主机及路由级别配置中以及通过特定请求的标头配置重试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#envoy支持在虚拟主机及路由级别配置中以及通过特定请求的标头配置重试"}},[t._v("#")]),t._v(" Envoy支持在虚拟主机及路由级别配置中以及通过特定请求的标头配置重试")]),t._v(" "),s("ul",[s("li",[t._v("路由级别重试的优先级高于虚拟主机级别。")])]),t._v(" "),s("h4",{attrs:{id:"重试策略的相关属性包括重试次数和重试条件等"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重试策略的相关属性包括重试次数和重试条件等"}},[t._v("#")]),t._v(" 重试策略的相关属性包括重试次数和重试条件等")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("最大重试次数")]),t._v("：可重试的最大次数\n"),s("ul",[s("li",[t._v("在每次重试之间使用"),s("strong",[t._v("指数退避算法")]),t._v("：\n"),s("ul",[s("li",[t._v("单次重试操作有其超时时长。")]),t._v(" "),s("li",[t._v("所有重试都包含在整个请求的超时时长之内，以避免由于大量重试而导致的超长请求时间。")])])])])]),t._v(" "),s("li",[s("strong",[t._v("重试条件")]),t._v("：指进行重试的前提条件，例如网络故障、5xx类的响应码等。")])]),t._v(" "),s("h4",{attrs:{id:"重试策略配置示例-代码片段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重试策略配置示例-代码片段"}},[t._v("#")]),t._v(" 重试策略配置示例（代码片段）")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("retry_policy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"retry_on"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重试发生的条件，其功能同rx-envoy-retry-grpc-on标头相同;")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"num_retries"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 最大重试次数，默认值为1，其功能同rx-envoy-max-retries标头相同，但采用二者中配置的最大值;")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"per_try_timeout"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每次重试的间隔时间上游请求超时时长;")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"retry_priority"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置重试优先策略，用于在负载均衡时配置优先级;")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"retry_host_predicate"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置用于拒绝主机的选择列表，各指用于拒绝主机，将参考该列表中任一主机断言;")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"host_selection_retry_max_attempts"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' "'),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 允许选择重试的最大次数，默认认为最大间隔默认为基本间隔（250ms）的10倍;")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"retriable_status_codes"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#"')]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置重试发生前的HTTP状态代码列表;")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"retry_back_off"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置用于重试的退避基准时间，例如初始退避时间为25ms，给定退避基准时间和基准后退退避时间（0，2^N-1）B，最大间隔默认为基本间隔（250ms）的10倍;")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"base_interval"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"max_interval"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"retriable_headers"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 触发重试的HTTP响应标头列表，定义响应标头和请求标头中的任何标头匹配时触发重试;")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"retriable_request_headers"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 必须用于重试的请求标头列表;")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br")])]),s("h3",{attrs:{id:"http请求重试条件-route-retrypolicy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http请求重试条件-route-retrypolicy"}},[t._v("#")]),t._v(" HTTP请求重试条件（route.RetryPolicy）")]),t._v(" "),s("h4",{attrs:{id:"重试条件1-同x-envoy-retry-on标头"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重试条件1-同x-envoy-retry-on标头"}},[t._v("#")]),t._v(" 重试条件1（同x-envoy-retry-on标头）")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("5xx")]),t._v("：上游主机返回5xx响应码，或者根本未响应（断开/重置/读取超时）。\n"),s("ul",[s("li",[t._v("包括但不限于502, 503, 504等应用进行重试。")])])]),t._v(" "),s("li",[s("strong",[t._v("gateway-error")]),t._v("：网络错误，类似于5xx策略，但仅为502、503或504的应用进行重试。")]),t._v(" "),s("li",[s("strong",[t._v("connection-failure")]),t._v("：在TCP级别与上游服务器建立连接失败时进行重试。")]),t._v(" "),s("li",[s("strong",[t._v("retriable-4xx")]),t._v("：上游服务器返回可重复的4xx响应码时进行重试。")]),t._v(" "),s("li",[s("strong",[t._v("refused-stream")]),t._v("：上游服务器使用REFUSED STREAM错误码重置时进行重试。")]),t._v(" "),s("li",[s("strong",[t._v("retriable-status-codes")]),t._v("：上游服务器的响应码与重试策略x-envoy-retriable-status-codes标头值中定义的响应码匹配时进行重试。")]),t._v(" "),s("li",[s("strong",[t._v("reset")]),t._v("：上游主机完全不响应时（disconnect/reset/read timeout），Envoy将进行重试。")]),t._v(" "),s("li",[s("strong",[t._v("retriable-headers")]),t._v("：如果上游服务器响应文匹配重试策略标头或x-envoy-retriable-header-names标头中包含的任何标头，则Envoy将尝试重试。")]),t._v(" "),s("li",[s("strong",[t._v("envoy-ratelimited")]),t._v("：标头中存在x-envoy-ratelimited时进行重试。")])]),t._v(" "),s("h4",{attrs:{id:"重试条件2-同x-envoy-retry-grpc-on标头"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重试条件2-同x-envoy-retry-grpc-on标头"}},[t._v("#")]),t._v(" 重试条件2（同x-envoy-retry-grpc-on标头）")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("cancelled")]),t._v("：gRPC应答标头中的状态码是“cancelled”时进行重试。")]),t._v(" "),s("li",[s("strong",[t._v("deadline-exceeded")]),t._v("：gRPC应答标头中的状态码是“deadline-exceeded”时进行重试。")]),t._v(" "),s("li",[s("strong",[t._v("internal")]),t._v("：gRPC应答标头中的状态码是“internal”时进行重试。")]),t._v(" "),s("li",[s("strong",[t._v("resource-exhausted")]),t._v("：gRPC应答标头中的状态码是“resource-exhausted”时进行重试。")]),t._v(" "),s("li",[s("strong",[t._v("unavailable")]),t._v("：gRPC应答标头中的状态码是“unavailable”时进行重试。")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("默认情况下，Envoy不会进行任何类型的重试操作，除非明确定义。")])])])}),[],!1,null,null,null);s.default=e.exports}}]);
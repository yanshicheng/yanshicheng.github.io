(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{402:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"线程模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#线程模型"}},[s._v("#")]),s._v(" 线程模型")]),s._v(" "),t("h3",{attrs:{id:"总体架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总体架构"}},[s._v("#")]),s._v(" 总体架构")]),s._v(" "),t("p",[s._v("Envoy 采用单进程多线程的架构模型。这种设计旨在平衡性能和可管理性。整个 Envoy 进程包含一个主线程和多个工作线程，以及专门的文件刷新线程。")]),s._v(" "),t("ol",[t("li",[s._v("主线程 (Main thread)\n主线程是 Envoy 的核心控制线程，负责以下任务：")])]),s._v(" "),t("ul",[t("li",[s._v("Envoy 进程的启动和关闭")]),s._v(" "),t("li",[s._v("xDS API 的处理：负责与控制平面进行通信，处理动态配置更新")]),s._v(" "),t("li",[s._v("DNS 解析：执行服务发现所需的 DNS 查询")]),s._v(" "),t("li",[s._v("健康状态检测：监控上游服务的健康状态")]),s._v(" "),t("li",[s._v("集群管理：维护和更新服务集群信息")]),s._v(" "),t("li",[s._v("运行时配置：处理动态运行时配置的更改")]),s._v(" "),t("li",[s._v("统计数据刷新：定期更新和导出性能指标")]),s._v(" "),t("li",[s._v("管理接口维护：处理管理 API 的请求")]),s._v(" "),t("li",[s._v("其他线程管理：包括信号处理和热重启等操作\n主线程采用事件驱动模型，使用异步非阻塞方式处理上述任务，确保高效运行。")])]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[s._v("工作线程 (Worker threads)\n工作线程是 Envoy 处理网络 I/O 和请求处理的核心。特点如下：")])]),s._v(" "),t("ul",[t("li",[s._v("数量：默认情况下，Envoy 会创建与 CPU 核心数量相等的工作线程。可以通过 "),t("code",[s._v("--concurrency")]),s._v(" 选项自定义。")]),s._v(" "),t("li",[s._v("职责：\n"),t("ul",[t("li",[s._v("监听指定的套接字")]),s._v(" "),t("li",[s._v("接收新的连接请求")]),s._v(" "),t("li",[s._v("为每个新连接创建过滤器链并处理整个连接生命周期中的所有事件")]),s._v(" "),t("li",[s._v("执行 L4/L7 协议解析")]),s._v(" "),t("li",[s._v("应用各种过滤器（如 HTTP 过滤器、网络过滤器）")]),s._v(" "),t("li",[s._v("执行负载均衡、路由决策")]),s._v(" "),t("li",[s._v("与上游服务建立连接并转发请求\n每个工作线程都运行一个非阻塞的事件循环，使用 libevent 或类似的事件库来高效处理大量并发连接。")])])])]),s._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[s._v("文件刷新线程 (File flush threads)\n文件刷新线程专门负责将日志和其他数据写入磁盘：")])]),s._v(" "),t("ul",[t("li",[s._v("目的：分离 I/O 操作，避免影响主线程和工作线程的性能")]),s._v(" "),t("li",[s._v("工作方式：当工作线程需要写入文件时，数据首先被移入内存缓冲区，然后由文件刷新线程异步写入磁盘")]),s._v(" "),t("li",[s._v("优势：减少磁盘 I/O 对整体性能的影响")])]),s._v(" "),t("ol",[t("li",[s._v("线程协作模型")])]),s._v(" "),t("ul",[t("li",[s._v("线程间通信：主要通过无锁队列和原子操作实现，最小化线程同步开销")]),s._v(" "),t("li",[s._v("工作分配：连接级别的负载均衡，新连接均匀分布到各工作线程")]),s._v(" "),t("li",[s._v("请求处理：单个连接的所有处理都在同一工作线程中完成，避免线程切换\n这种设计允许 Envoy 高效地利用多核处理器，同时保持良好的可扩展性和管理性。主线程处理全局任务和配置更新，而工作线程专注于高性能的请求处理，文件刷新线程则确保日志写入不会影响主要处理流程。\nEnvoy 线程模型流程图：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("+-------------------+\n|     Main Thread   |\n+-------------------+\n| - Process startup |\n| - xDS API handling|\n| - DNS resolution  |\n| - Health checking |\n| - Cluster mgmt    |\n| - Runtime config  |\n| - Stats flushing  |\n| - Admin interface |\n| - Thread mgmt     |\n+--------+----------+\n         |\n         v\n+-------------------+     +-------------------+     +-------------------+\n|   Worker Thread 1 |     |   Worker Thread 2 |     |   Worker Thread N |\n+-------------------+     +-------------------+     +-------------------+\n| - Listen for conns|     | - Listen for conns|     | - Listen for conns|\n| - Accept new conns|     | - Accept new conns|     | - Accept new conns|\n| - Process requests|     | - Process requests|     | - Process requests|\n| - Apply filters   |     | - Apply filters   |     | - Apply filters   |\n| - Load balancing  |     | - Load balancing  |     | - Load balancing  |\n| - Upstream comms  |     | - Upstream comms  |     | - Upstream comms  |\n+--------+----------+     +--------+----------+     +--------+----------+\n         |                         |                         |\n         |                         |                         |\n         v                         v                         v\n+-------------------+     +-------------------+     +-------------------+\n| File Flush Thread |     | File Flush Thread |     | File Flush Thread |\n+-------------------+     +-------------------+     +-------------------+\n| - Write logs      |     | - Write logs      |     | - Write logs      |\n| - Flush to disk   |     | - Flush to disk   |     | - Flush to disk   |\n+-------------------+     +-------------------+     +-------------------+\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("p",[s._v("这个流程图展示了:")]),s._v(" "),t("ol",[t("li",[s._v("顶部的主线程，负责全局任务和管理。")]),s._v(" "),t("li",[s._v("中间是多个工作线程，每个都独立处理连接和请求。")]),s._v(" "),t("li",[s._v("底部是文件刷新线程，负责将日志写入磁盘。\n箭头表示了线程之间的关系和数据流向。主线程管理和协调工作线程，而工作线程和文件刷新线程之间有数据传递。")])]),s._v(" "),t("h3",{attrs:{id:"连接处理流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#连接处理流程"}},[s._v("#")]),s._v(" 连接处理流程")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://wiki-images.yanshicheng.com/static/202408011510490.webp",alt:""}}),s._v("\n这个流程图描述了一个复杂的网络通信系统,主要涉及 HTTP 和 TCP 协议。图中的组件从 1 到 20 编号,表示数据流动的顺序。以下是详细解释:")]),s._v(" "),t("ol",[t("li",[s._v("Worker (工作器): 这是整个流程的起点,可能是处理请求的主要组件。")]),s._v(" "),t("li",[s._v("Listener filters (监听器过滤器): 对传入的连接进行初步处理。")]),s._v(" "),t("li",[s._v("Connection (连接): 建立网络连接。")]),s._v(" "),t("li",[s._v("TCP Filter manager (TCP 过滤器管理器): 管理 TCP 层面的各种过滤器。")]),s._v(" "),t("li",[s._v("TCP Read Filters (TCP 读取过滤器): 处理传入的 TCP 数据。")]),s._v(" "),t("li",[s._v("TCP write Filters (TCP 写入过滤器): 处理外发的 TCP 数据。")]),s._v(" "),t("li",[s._v("HTTP Codec (HTTP 编解码器): 在 TCP 和 HTTP 协议之间进行转换。")]),s._v(" "),t("li",[s._v("HTTP conn Manager (HTTP 连接管理器): 管理 HTTP 连接。")]),s._v(" "),t("li",[s._v("HTTP read filters (HTTP 读取过滤器): 处理传入的 HTTP 请求。")]),s._v(" "),t("li",[s._v("HTTP write filters (HTTP 写入过滤器): 处理外发的 HTTP 响应。")]),s._v(" "),t("li",[s._v("Service router (服务路由器): 将请求路由到适当的服务。")]),s._v(" "),t("li",[s._v("upstream Conn pool (上游连接池): 管理与后端服务的连接。")]),s._v(" "),t("li",[s._v("Backend service (后端服务): 实际处理请求的服务。\n数据流程:")]),s._v(" "),t("li",[s._v("请求从 Worker 开始,经过监听器过滤器和连接组件。")]),s._v(" "),t("li",[s._v("然后进入 TCP 层,通过 TCP 过滤器管理器和各种 TCP 过滤器。")]),s._v(" "),t("li",[s._v("数据再传递到 HTTP 层,经过 HTTP 编解码器、连接管理器和 HTTP 过滤器。")]),s._v(" "),t("li",[s._v("服务路由器将请求定向到正确的服务。")]),s._v(" "),t("li",[s._v("上游连接池管理与后端服务的连接。")]),s._v(" "),t("li",[s._v("最后,请求到达后端服务进行处理。")]),s._v(" "),t("li",[s._v("响应则按照相反的路径返回。")])]),s._v(" "),t("h3",{attrs:{id:"http-连接管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#http-连接管理"}},[s._v("#")]),s._v(" HTTP 连接管理")]),s._v(" "),t("p",[t("strong",[s._v("Envoy 通过内置的 L4 过滤器 HTTP 连接管理器将原始字节转换为 HTTP 应用层协议级别的消息和事件")]),s._v("，例如接收到的标头和主体等，以及处理所有 HTTP 连接和请求共有的功能，包括访问日志、生成和跟踪请求 ID、请求/响应头处理、路由表管理和统计信息等：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("支持 HTTP/1.1、WebSockets 和 HTTP/2，但不支持 SPDY")])]),s._v(" "),t("li",[s._v("关联的路由表可静态配置，也可经由 xDS API 中的 RDS 动态生成")]),s._v(" "),t("li",[s._v("内建重试插件，可用于配置重试行为\n"),t("ul",[t("li",[s._v("Host Predicates")]),s._v(" "),t("li",[s._v("Priority Predicates")])])]),s._v(" "),t("li",[s._v("内建支持 302 重定向，它可以捕获指定响应，合成新请求后将其发送到新的路由匹配(match)所指定的上游端点，并将收到的响应作为对原始请求的响应返回客户端")]),s._v(" "),t("li",[s._v("支持适用于 HTTP 连接及其组成流（constituent streams）的多种可配置超时机制\n"),t("ul",[t("li",[s._v("连接级别：空闲超时和排空超时（GOAWAY）")]),s._v(" "),t("li",[s._v("流级别：空闲超时，每路由相关的上游超时和每路由相关的 gRPC 最大超时时长")])])]),s._v(" "),t("li",[s._v("基于自定义集群的动态转发代理；")]),s._v(" "),t("li",[s._v("HTTP 协议相关的功能通过各 HTTP 过滤器实现，这些过滤器大体可分为编码器、解码器和编/解码器三类；\n"),t("ul",[t("li",[t("strong",[s._v("router（envoy.router）是最常的过滤器之一")]),s._v("，它基于路由表完成请求的转发或重定向，以及处理重试操作和生成统计信息等；\n主要点")])])])]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("Envoy 的 HTTP 连接管理器")]),s._v("：将原始字节转换为 HTTP 应用层消息和事件。")]),s._v(" "),t("li",[t("strong",[s._v("支持的协议")]),s._v("：HTTP/1.1、WebSockets 和 HTTP/2（不支持 SPDY）。")]),s._v(" "),t("li",[t("strong",[s._v("路由表")]),s._v("：可以静态配置或通过 xDS API 动态生成。")]),s._v(" "),t("li",[t("strong",[s._v("重试插件")]),s._v("：可配置的重试行为，包括主机谓词和优先级谓词。")]),s._v(" "),t("li",[t("strong",[s._v("302 重定向")]),s._v("：内置支持处理 302 重定向，通过合成新请求并发送到匹配的上游端点。")]),s._v(" "),t("li",[t("strong",[s._v("超时机制")]),s._v("：在连接和流级别都可配置，包括空闲超时和每路由相关的 gRPC 最大超时。")]),s._v(" "),t("li",[t("strong",[s._v("动态转发")]),s._v("：基于自定义集群。")]),s._v(" "),t("li",[t("strong",[s._v("HTTP 过滤器")]),s._v("：实现 HTTP 协议相关功能，分为编码器、解码器和编/解码器三类。")]),s._v(" "),t("li",[t("strong",[s._v("路由过滤器")]),s._v("：最常见的过滤器之一，处理请求转发或重定向、重试操作和统计信息生成。")])]),s._v(" "),t("h2",{attrs:{id:"虚拟主机-virtual-hosts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#虚拟主机-virtual-hosts"}},[s._v("#")]),s._v(" 虚拟主机 (Virtual Hosts)")]),s._v(" "),t("p",[s._v("虚拟主机是 Envoy 中处理 HTTP 请求路由的核心概念。")]),s._v(" "),t("ul",[t("li",[s._v("定义：虚拟主机是一组路由规则的逻辑分组，与一个或多个域名相关联。")]),s._v(" "),t("li",[s._v("功能：允许单个 Envoy 实例处理多个域名的流量，实现基于域名的请求分发。")]),s._v(" "),t("li",[s._v("匹配逻辑：Envoy 使用 HTTP/1.1 的 Host 头或 HTTP/2 的 :authority 伪头来匹配虚拟主机。")]),s._v(" "),t("li",[s._v("通配符支持：支持精确匹配、前缀匹配、后缀匹配和通配符匹配。\n"),t("code",[s._v("配置示例：")])])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("virtual_hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" main\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("domains")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*.example.com'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'example.com'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("routes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" api\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("domains")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'api.another-example.com'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("routes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("domains")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("routes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h2",{attrs:{id:"路由"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#路由"}},[s._v("#")]),s._v(" 路由")]),s._v(" "),t("p",[s._v("路由配置是 Envoy 中处理 HTTP 请求的核心机制，它定义了如何匹配 incoming 请求并决定如何处理这些请求。")]),s._v(" "),t("h3",{attrs:{id:"域名搜索机制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#域名搜索机制"}},[s._v("#")]),s._v(" 域名搜索机制")]),s._v(" "),t("p",[s._v("将请求报文中的 host 标头依次与路由表定义的各 Virtualhost 的 domain 属性值进行比较，并于第一次匹配终止搜索。\n匹配顺序\n精准匹配 -> 左前缀匹配 -> 右前缀匹配 -> 通配符")]),s._v(" "),t("h3",{attrs:{id:"路由匹配-match"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#路由匹配-match"}},[s._v("#")]),s._v(" 路由匹配 (match)")]),s._v(" "),t("p",[s._v("路由匹配决定了哪些请求会被特定的路由规则处理。它分为两类：")]),s._v(" "),t("h4",{attrs:{id:"基础匹配"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基础匹配"}},[s._v("#")]),s._v(" 基础匹配")]),s._v(" "),t("ul",[t("li",[s._v("prefix: 匹配 URL 路径前缀")]),s._v(" "),t("li",[s._v("path: 匹配完整的 URL 路径")]),s._v(" "),t("li",[s._v("safe_regex: 使用安全的正则表达式匹配 URL 路径\n示例：")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/api/v1'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("(<routes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由配置列表")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prefix_route"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由的名称")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配 URL 路径前缀为 /")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("case_sensitive")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# URL 路径匹配是否大小写敏感")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster1"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求将被路由到 cluster1 集群")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"path_route"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由的名称")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/message"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配完整的 URL 路径为 /message")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster2"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求将被路由到 cluster2 集群")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"regex_route"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由的名称")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("safe_regex")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用安全的正则表达式匹配 URL 路径")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("google_re2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 Google RE2 引擎")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("regex")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*static.*"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 匹配路径中带有 "static" 的 URL')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster3"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求将被路由到 cluster3 集群>)")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("h4",{attrs:{id:"查询参数匹配"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询参数匹配"}},[s._v("#")]),s._v(" 查询参数匹配")]),s._v(" "),t("ul",[t("li",[s._v("query_parameters: 匹配 URL 查询参数\n示例：")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("routes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"example_route"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由的名称")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配 URL 路径前缀")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("query_parameters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配 URL 查询参数")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exact_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value1"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 精确匹配查询参数 param1 的值")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2"')]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pre"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前缀匹配查询参数 param2 的值")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param3"')]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("suffix_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"suf"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后缀匹配查询参数 param3 的值")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param4"')]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("contains_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sub"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 包含匹配查询参数 param4 的值")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param5"')]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("safe_regex_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用安全的正则表达式匹配查询参数 param5 的值")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("google_re2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("regex")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*regex.*"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param6"')]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("string_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exact_string"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 字符串匹配查询参数 param6 的值")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param7"')]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("present_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存在性匹配查询参数 param7 是否存在")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param8"')]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exact_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value8"')]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ignore_case")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 忽略大小写匹配查询参数 param8 的值")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"example_cluster"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求将被路由到 example_cluster 集群")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h4",{attrs:{id:"请求头匹配"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#请求头匹配"}},[s._v("#")]),s._v(" 请求头匹配")]),s._v(" "),t("ul",[t("li",[s._v("headers: 匹配 HTTP 请求头\n"),t("ul",[t("li",[s._v("exact_match: 精确值匹配")]),s._v(" "),t("li",[s._v("safe_regex_match: 正则表达式模式匹配")]),s._v(" "),t("li",[s._v("range_match: 值范围匹配，检查标头值是否在指定的范围")]),s._v(" "),t("li",[s._v("present_match: 标头存在性匹配，检查标头值是否在指定的范围内。")]),s._v(" "),t("li",[s._v("prefix_match: 值前缀匹配")]),s._v(" "),t("li",[s._v("suffix_match: 值后缀匹配")]),s._v(" "),t("li",[s._v("contains_match: 检测标头值是否包含此处指定的字符串。")]),s._v(" "),t("li",[s._v("string_match: 检测标头值是否匹配此处指定的字符串。")]),s._v(" "),t("li",[s._v("invert_match: 是否将匹配的检测结果取反，即以不满足条件为真，默认为false。")])])])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("routes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由配置列表")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"example_route"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由的名称")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配 URL 路径前缀")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("headers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配 HTTP 请求头")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-custom-header"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求头的名称")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exact_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"header_value"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 精确匹配 x-custom-header 的值")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-regex-header"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求头的名称")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("safe_regex_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用安全的正则表达式匹配")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("google_re2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 Google RE2 正则表达式引擎")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("regex")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*value.*"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正则表达式")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-range-header"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求头的名称")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("range_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 值范围匹配 x-range-header 的值")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配值的起始范围")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("end")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配值的结束范围")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-present-header"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求头的名称")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("present_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存在性匹配 x-present-header 是否存在")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-prefix-header"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求头的名称")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prefix"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前缀匹配 x-prefix-header 的值")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-suffix-header"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求头的名称")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("suffix_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"suffix"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后缀匹配 x-suffix-header 的值")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-contains-header"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求头的名称")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("contains_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"substring"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 包含匹配 x-contains-header 的值")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-string-header"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求头的名称")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("string_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exact_string"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 字符串匹配 x-string-header 的值")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-invert-header"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求头的名称")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("invert_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 反向匹配 x-invert-header 的匹配结果")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("query_parameters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配 URL 查询参数")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询参数的名称")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exact_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value1"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 精确匹配查询参数 param1 的值")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询参数的名称")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("safe_regex_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用安全的正则表达式匹配")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("google_re2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 Google RE2 正则表达式引擎")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("regex")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*value.*"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正则表达式")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"example_cluster"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求将被路由到 example_cluster 集群")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])]),t("h3",{attrs:{id:"路由动作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#路由动作"}},[s._v("#")]),s._v(" 路由动作")]),s._v(" "),t("p",[s._v("匹配成功后，Envoy 会执行指定的路由动作。主要有三种：")]),s._v(" "),t("h4",{attrs:{id:"路由-route"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#路由-route"}},[s._v("#")]),s._v(" 路由 (route)")]),s._v(" "),t("p",[s._v("将请求转发到指定的上游集群。")]),s._v(" "),t("ul",[t("li",[s._v("cluster: 路由到指定的集群")]),s._v(" "),t("li",[s._v("cluster_header: 路由到请求标头中由 cluster_header 的值指定的上游集群。")]),s._v(" "),t("li",[s._v("weighted_cluster: 基于权重降请求路由至多个上游，进行流量分割")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_cluster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("(<routes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"direct_route"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由的名称")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配 URL 路径前缀")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster1"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由到指定的集群 cluster1")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"header_route"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由的名称")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/header"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配 URL 路径前缀 /header")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster_header")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-cluster-header"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由到请求标头中由 x-cluster-header 的值指定的上游集群")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"weighted_route"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由的名称")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/weighted"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配 URL 路径前缀 /weighted")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weighted_clusters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基于权重进行流量分割的配置")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clusterA"')]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 80%的流量路由到 clusterA")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clusterB"')]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 20%的流量路由到 clusterB>)")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("h4",{attrs:{id:"重定向-redirect"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重定向-redirect"}},[s._v("#")]),s._v(" 重定向 (redirect)")]),s._v(" "),t("p",[s._v("返回 HTTP 重定向响应，将客户端重定向到新的位置。")]),s._v(" "),t("ul",[t("li",[s._v("协议重定向: https_redirect 或 scheme_redirect 二者只能使用其一。")]),s._v(" "),t("li",[s._v("主机重定向: host_redirect")]),s._v(" "),t("li",[s._v("端口重定向: port_redirect")]),s._v(" "),t("li",[s._v("路径重定向: path_redirect")]),s._v(" "),t("li",[s._v("路径前缀重定向: prefix_redirect")]),s._v(" "),t("li",[s._v("正则表达式模式定义的重定向: regex_rewrite")]),s._v(" "),t("li",[s._v("重设响应吗: response_code 默认为 301")]),s._v(" "),t("li",[s._v("strip_query: 是否在重定向期间删除 URL 中的查询参数，默认为 false。")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("routes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https_redirect_route"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由的名称")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/redirect"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配 URL 路径前缀 /redirect")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("https_redirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 协议重定向到 HTTPS")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host_redirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"newhost.com"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机重定向到 newhost.com")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port_redirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 端口重定向到 443")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path_redirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/newpath"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路径重定向到 /newpath")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("response_code")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("302")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重定向响应码为 302")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strip_query")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在重定向期间删除 URL 中的查询参数")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scheme_redirect_route"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由的名称")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/scheme"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配 URL 路径前缀 /scheme")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scheme_redirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 协议重定向到 HTTPS")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host_redirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"example.com"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机重定向到 example.com")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port_redirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8443")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 端口重定向到 8443")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix_redirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/prefix"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路径前缀重定向到 /prefix")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("response_code")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重定向响应码为 301")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strip_query")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在重定向期间保留 URL 中的查询参数")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"regex_rewrite_route"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由的名称")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/regex"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配 URL 路径前缀 /regex")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("regex_rewrite")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正则表达式模式定义的重定向")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("google_re2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("regex")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^/oldpath/(.*)$"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配 /oldpath/ 后面的所有内容")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("substitution")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/newpath/\\\\1"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重定向到 /newpath/ 后面的所有内容")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("response_code")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重定向响应码为 301")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strip_query")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在重定向期间删除 URL 中的查询参数")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("h4",{attrs:{id:"直接响应-direct-response"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#直接响应-direct-response"}},[s._v("#")]),s._v(" 直接响应 (direct_response):")]),s._v(" "),t("p",[s._v("不转发请求，而是直接返回指定的响应。")]),s._v(" "),t("ul",[t("li",[s._v("status: 指定状态吗")]),s._v(" "),t("li",[s._v("body: 消息体\n"),t("ul",[t("li",[s._v("filename: 本地文件数据源")]),s._v(" "),t("li",[s._v("inline_byte: 直接给出的内联字节")]),s._v(" "),t("li",[s._v("inline_string: 直接给出的内联字符串")])])])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("listeners")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" listener_0\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("socket_address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 0.0.0.0\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port_value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("filter_chains")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("filters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" envoy.filters.network.http_connection_manager\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("typed_config")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"@type"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stat_prefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ingress_http\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route_config")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" local_route\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("virtual_hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" local_service\n                      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("domains")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n                      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("routes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v("\n                          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("direct_response")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接响应配置")]),s._v("\n                            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 状态码，200表示成功")]),s._v("\n                            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("body")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("inline_string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello, world!"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 直接给出的内联字符串，内容为 "Hello, world!"')]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http_filters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" envoy.filters.http.router\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_backend\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("connect_timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 0.25s\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" LOGICAL_DNS\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dns_lookup_family")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" V4_ONLY\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("lb_policy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ROUND_ROBIN\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("load_assignment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_backend\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("endpoints")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("lb_endpoints")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("endpoint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("socket_address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" backend\n                      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port_value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br")])]),t("h2",{attrs:{id:"高级路由功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#高级路由功能"}},[s._v("#")]),s._v(" 高级路由功能")]),s._v(" "),t("ul",[t("li",[s._v("加权集群路由：将流量按比例分发到多个集群")]),s._v(" "),t("li",[s._v("重试策略(retry_policy)：定义请求失败时的重试行为")]),s._v(" "),t("li",[s._v("超时设置(timeout)：为路由设置请求超时时间")]),s._v(" "),t("li",[s._v("流量分割()：实现 A/B 测试或金丝雀发布")]),s._v(" "),t("li",[s._v("故障注入()：用于测试服务弹性")]),s._v(" "),t("li",[s._v("请求镜像：复制流量到镜像服务进行分析\n示例配置：")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("routes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/api/v2'")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("headers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'User-Agent'")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Mozilla'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weighted_clusters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_v2_cluster_1\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_v2_cluster_2\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("retry_policy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("retry_on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" connect"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("failure"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("refused"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stream"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("unavailable\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("num_retries")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 30s\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("request_mirror_policies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" analytics_cluster\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runtime_fraction")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default_value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("numerator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("denominator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HUNDRED\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("p",[s._v("这个配置展示了如何组合使用多种路由功能，包括路径前缀匹配、头部匹配、加权集群路由、重试策略、超时设置和请求镜像。\n通过灵活运用这些路由配置选项，Envoy 可以实现复杂的流量管理策略，满足现代微服务架构中的各种需求，如负载均衡、流量分割、服务版本控制、故障恢复等。这种细粒度的控制使得 Envoy 成为构建健壮和可扩展的服务网格的理想选择。我理解您需要更全面、深入的介绍。让我为您提供一个更加全面和深入的 Envoy 虚拟主机、路由和 HTTP 流量治理的讲解。")]),s._v(" "),t("ol",[t("li"),s._v(" "),t("li",[s._v("路由 (Routes)")])]),s._v(" "),t("p",[s._v("路由定义了请求匹配条件和相应的处理动作。\n深入解析：")]),s._v(" "),t("ul",[t("li",[s._v("匹配条件：包括路径前缀、精确路径、正则表达式、查询参数、HTTP 方法等。")]),s._v(" "),t("li",[s._v("优先级：路由按照定义顺序匹配，更具体的路由应该放在前面。")]),s._v(" "),t("li",[s._v("处理动作：包括转发到上游集群、重定向、直接响应、路由到其他虚拟主机等。")])]),s._v(" "),t("p",[s._v("高级路由配置示例：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("routes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/api/v1'")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("headers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type'")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exact_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'application/json'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" api_cluster_v1\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 15s\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("retry_policy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("retry_on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" connect"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("failure"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("refused"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stream"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("unavailable\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("num_retries")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/health'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("direct_response")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("body")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("inline_string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'OK'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/old-api'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path_redirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/api/v1'")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("response_code")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("ol",[t("li",[s._v("HTTP 流量治理")])]),s._v(" "),t("p",[s._v("Envoy 提供了丰富的 HTTP 流量治理功能，用于控制和优化流量。\na) 高级重试机制")]),s._v(" "),t("ul",[t("li",[s._v("支持基于状态码、头部、上游服务故障等条件的重试。")]),s._v(" "),t("li",[s._v("可配置重试预算，避免重试风暴。")]),s._v(" "),t("li",[s._v("支持主机选择重试策略。")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("retry_policy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("retry_on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" connect"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("failure"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("refused"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stream"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("unavailable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("5xx\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("num_retries")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("per_try_timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1s\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("retry_host_predicate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" envoy.retry_host_predicates.previous_hosts\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host_selection_retry_max_attempts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("retry_priority")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" envoy.retry_priorities.previous_priorities\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("config")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("update_frequency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("b) 复杂超时控制")]),s._v(" "),t("ul",[t("li",[s._v("支持整体请求超时、每次尝试超时、空闲超时等。")]),s._v(" "),t("li",[s._v("可以针对特定路由或整个集群设置。")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_cluster\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 30s\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("idle_timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5s\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_stream_duration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("grpc_timeout_header_max")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("c) 高级断路器")]),s._v(" "),t("ul",[t("li",[s._v("支持多种断路器类型：最大连接数、最大等待请求数、最大重试次数等。")]),s._v(" "),t("li",[s._v("可以为不同优先级流量设置不同的断路器阈值。")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("circuit_breakers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("thresholds")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("priority")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DEFAULT\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_connections")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_pending_requests")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_requests")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_retries")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("priority")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HIGH\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_connections")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_pending_requests")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_requests")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_retries")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("d) 动态流量分割")]),s._v(" "),t("ul",[t("li",[s._v("支持基于权重的流量分割。")]),s._v(" "),t("li",[s._v("可以与运行时配置结合，实现动态调整。")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weighted_clusters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_v1\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_v2\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runtime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" routing.traffic_split.service\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("e) 高级请求速率限制")]),s._v(" "),t("ul",[t("li",[s._v("支持本地和全局速率限制。")]),s._v(" "),t("li",[s._v("可以基于多种因素进行限制，如客户端 IP、请求路径、HTTP 头等。")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rate_limit_service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("grpc_service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("envoy_grpc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rate_limit_cluster\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rate_limits")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("actions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("header_value_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("descriptor_value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'high-volume-endpoint'")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("headers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("':path'")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exact_match")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/api/high-volume'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("f) 高级请求镜像")]),s._v(" "),t("ul",[t("li",[s._v("支持流量镜像到多个目标。")]),s._v(" "),t("li",[s._v("可以控制镜像流量的百分比。")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" primary_cluster\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("request_mirror_policies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mirror_cluster_1\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runtime_fraction")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default_value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("numerator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("denominator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HUNDRED\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mirror_cluster_2\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runtime_fraction")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default_value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("numerator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("denominator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HUNDRED\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("g) 复杂的头部操作")]),s._v(" "),t("ul",[t("li",[s._v("支持添加、移除、修改请求和响应头。")]),s._v(" "),t("li",[s._v("支持基于条件的头部操作。")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("request_headers_to_add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("header")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'x-request-id'")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%REQ(X-REQUEST-ID)%'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("append")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("response_headers_to_remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'x-powered-by'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("headers_to_add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("header")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'x-envoy-upstream-service-time'")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%RESPONSE_DURATION%'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("append")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("h) 故障注入")]),s._v(" "),t("ul",[t("li",[s._v("支持延迟和错误注入，用于测试服务弹性。")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fault")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("delay")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fixed_delay")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5s\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("percentage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("numerator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("denominator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HUNDRED\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("abort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http_status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("percentage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("numerator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("denominator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HUNDRED\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("i) 动态路由配置")]),s._v(" "),t("ul",[t("li",[s._v("支持通过 xDS API 动态更新路由配置。")]),s._v(" "),t("li",[s._v("允许在运行时修改路由行为，无需重启 Envoy。")])]),s._v(" "),t("p",[s._v("j) 高级负载均衡")]),s._v(" "),t("ul",[t("li",[s._v("支持多种负载均衡算法：轮询、最少请求、一致性哈希等。")]),s._v(" "),t("li",[s._v("支持区域感知路由，优先选择同区域的上游服务。")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("load_assignment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_cluster\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("endpoints")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("lb_endpoints")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("endpoint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("socket_address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10.0.0.1\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port_value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("health_status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HEALTHY\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("load_balancing_weight")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("lb_endpoints")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("endpoint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("socket_address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10.0.0.2\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port_value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("health_status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HEALTHY\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("load_balancing_weight")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("这些高级特性使 Envoy 能够精细地控制 HTTP 流量，实现复杂的流量管理策略。通过组合使用这些功能，可以构建出强大、灵活且高度可配置的服务网格和 API 网关解决方案，满足现代分布式系统的各种需求。Envoy 的这些特性使其成为微服务架构中不可或缺的组件，能够有效地解决服务发现、负载均衡、熔断、限流、监控等关键问题。")])])}),[],!1,null,null,null);t.default=e.exports}}]);
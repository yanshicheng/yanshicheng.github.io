---
url: /01.指南/10.使用/06.镜像管库.md
---

# 镜像仓库管理

本文档介绍如何在 Kube Nova 平台中管理容器镜像仓库，包括仓库配置、项目管理、制品管理和垃圾回收等功能。

镜像仓库管理功能用于管理和配置容器镜像仓库，支持对接 Harbor 等主流镜像仓库服务。通过统一管理镜像仓库，可以方便地浏览项目、查看镜像制品、管理存储空间等。

**操作路径**：集群管理 → 镜像仓库

✨ **特性:**

* 公共仓库仓木全局可访问(集群要先绑定 harbor 实例)
* 私有仓库项目可绑定平台项目，实现仓库隔离
* Harbor 可绑定集群，实现集群 harbor 隔离

***

## 创建镜像仓库

点击「创建仓库」按钮打开创建对话框，配置以下信息：

### 基本配置

**仓库名称**（必填）：输入仓库的显示名称，用于在平台中标识该仓库。

**仓库类型**（必填）：选择仓库类型，目前支持 Harbor。

**环境类型**（必填）：选择仓库所属的环境，可选开发、测试、预发、生产四种环境类型。

**仓库地址**（必填）：输入仓库的访问地址，例如 `https://harbor.example.com`。

### 认证配置

**用户名**（必填）：输入访问仓库的用户名。

**密码**（必填）：输入访问仓库的密码。

**跳过证书验证**：如果仓库使用自签名证书，请开启此选项。开启后将跳过 TLS 证书验证。

**CA 证书**（可选）：如果不跳过证书验证，可以粘贴 CA 证书内容用于验证仓库的 TLS 证书。

### 其他配置

**状态**：设置仓库的启用状态，可选禁用或启用。禁用后该仓库将不可用于镜像拉取等操作。

**描述**（可选）：输入仓库的描述信息。

配置完成后，建议点击「测试连接」验证仓库连接是否正常，确认无误后点击「创建」完成创建。

***

## 仓库列表

仓库列表页面展示所有已配置的镜像仓库，支持卡片视图和列表视图两种展示方式。

### 仓库卡片信息

每个仓库以卡片形式展示以下信息：

**仓库标识**：仓库名称、状态（启用/禁用）、仓库地址（可复制）。

**仓库标签**：显示仓库类型（如 Harbor）、环境类型（如 开发）、证书验证状态（如 跳过验证）。

**统计信息**：项目数量、仓库数量（镜像仓库总数）、存储使用量。

**管理信息**：管理员用户名、创建时间。

### 搜索与筛选

页面顶部提供多维度筛选功能：按名称搜索仓库、按环境类型筛选、按仓库类型筛选、按状态筛选。

### 仓库操作

每个仓库卡片底部提供以下操作：

**管理**：进入仓库的项目管理页面，可以查看和管理仓库中的所有项目。

**绑定**：将仓库绑定到特定的集群或项目，使其可以被使用。

**更多操作**（点击三点菜单）：编辑仓库配置、删除仓库等。

***

## 项目管理

点击仓库卡片的「管理」按钮进入项目管理页面。项目管理页面包含六个标签页：项目详情、项目管理、用户管理、垃圾回收、保留策略、复制策略。

### 项目详情

项目详情标签页展示仓库的整体概览信息。

**统计概览**展示四个核心指标：项目总数（仓库中的项目数量）、仓库总数（所有项目中的镜像仓库总数）、私有项目（访问权限为私有的项目数量）、公开项目（访问权限为公开的项目数量）。

**存储信息**展示仓库的存储使用情况：总容量、已使用空间、可用空间、使用率。存储信息以环形图直观展示使用比例。

**基本信息**展示仓库的配置详情，包括仓库地址、类型、认证方式等。

### 项目管理

项目管理标签页展示仓库中所有项目的列表。

**列表字段**包括：项目名称（带 ID 标识）、访问权限（公开/私有）、已用配额（当前存储使用量）、配额限制（存储配额上限，无限制表示不限制）、拥有者、仓库数量、操作。

**项目操作**根据项目类型有所不同：

对于公开项目：分配用户（管理项目成员权限）、查看（进入制品管理页面）、编辑、配额管理、删除。

对于私有项目：额外显示「绑定项目」按钮，用于将仓库项目与平台项目关联。

**创建项目**：点击页面右上角「创建项目」按钮可以在仓库中创建新项目。

### 用户管理

用户管理标签页用于管理仓库的用户和权限。可以添加用户、分配角色、管理访问权限等。

### 垃圾回收

垃圾回收功能用于清理未使用的镜像层和制品，释放存储空间。

**任务列表**展示垃圾回收任务的执行历史，包括：任务名称、任务类型（SCHEDULE 表示定时任务）、状态（成功/失败/运行中）、删除无标签镜像（是/否）、创建时间、更新时间、操作（详情、日志）。

**操作功能**：

「立即执行 GC」手动触发一次垃圾回收任务。

「调度配置」配置定时垃圾回收的执行计划，例如每天凌晨执行。

「刷新」刷新任务列表。

### 保留策略

保留策略用于配置镜像的自动清理规则，例如保留最近 N 个版本、保留最近 N 天的镜像等。通过合理配置保留策略，可以自动清理旧版本镜像，节省存储空间。

### 复制策略

复制策略用于配置镜像在不同仓库之间的同步规则。可以设置源仓库、目标仓库、复制触发条件（手动/定时/事件触发）等，实现镜像的跨仓库分发。

***

## 制品管理

在项目管理页面点击项目的「查看」按钮，进入制品管理页面。

### 仓库列表

制品管理页面展示项目中的所有镜像仓库，支持卡片视图和列表视图。

**仓库卡片信息**包括：仓库名称（格式为 `项目名/镜像名`，如 `argocd/dex`）、描述信息、制品数量（该仓库中的镜像标签数量）、拉取次数（镜像被拉取的总次数）、最后更新时间。

**仓库操作**：点击「查看」按钮查看仓库中的所有制品（镜像标签）。

### 制品列表

点击仓库的「查看」按钮，打开制品列表对话框，展示该仓库中的所有镜像标签。

**列表字段**包括：标签（镜像版本号，如 v2.38.0、v2.41.1）、类型（IMAGE 表示容器镜像）、摘要（镜像的 SHA256 摘要，用于唯一标识）、大小（镜像文件大小）、推送时间、拉取次数、操作。

**制品操作**：

「复制」复制镜像的完整拉取地址到剪贴板，方便在部署时使用。

「删除」删除该镜像标签。删除后无法恢复，请谨慎操作。

***

## 仓库绑定

仓库绑定功能用于将镜像仓库与 Kube Nova 平台中的集群或项目关联，使集群能够从该仓库拉取镜像。

### 绑定到集群

将仓库绑定到集群后，该集群中的工作负载可以使用此仓库中的镜像。绑定时会自动在集群中创建对应的 Secret，用于镜像拉取认证。

### 绑定到项目

将仓库中的项目与平台项目关联后，可以在项目的命名空间中直接使用该仓库的镜像，无需手动配置镜像拉取密钥。

***

## 最佳实践

### 环境隔离

建议按环境类型配置不同的镜像仓库，开发环境使用开发仓库，生产环境使用生产仓库，避免开发镜像误部署到生产环境。

### 存储管理

定期执行垃圾回收清理无用镜像层。配置合理的保留策略自动清理旧版本镜像。监控存储使用情况，及时扩容或清理。

### 安全配置

生产环境建议使用正规 CA 签发的证书，避免跳过证书验证。为不同用途创建不同的仓库账户，遵循最小权限原则。私有项目应限制访问权限，只对必要的用户开放。

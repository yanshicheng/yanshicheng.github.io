import{_ as s,c as n,o as e,aM as i}from"./chunks/framework.DvFTVADX.js";const k=JSON.parse('{"title":"开发指南","description":"","frontmatter":{"title":"开发指南","date":"2025-03-26T00:31:58.000Z","permalink":"/nova/dev","categories":["指南"],"tags":["指南"]},"headers":[],"relativePath":"nova/dev.md","filePath":"01.指南/40.开发/01.开发指南.md","lastUpdated":null}'),t={name:"nova/dev.md"};function p(l,a,r,o,d,h){return e(),n("div",null,a[0]||(a[0]=[i(`<div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /01.指南/40.开发/01.开发指南.md for this page in Markdown format</div><h1 id="kube-nova-开发指南" tabindex="-1">Kube-Nova 开发指南 <a class="header-anchor" href="#kube-nova-开发指南" aria-label="Permalink to &quot;Kube-Nova 开发指南&quot;">​</a></h1><h2 id="环境准备" tabindex="-1">环境准备 <a class="header-anchor" href="#环境准备" aria-label="Permalink to &quot;环境准备&quot;">​</a></h2><h3 id="后端开发环境" tabindex="-1">后端开发环境 <a class="header-anchor" href="#后端开发环境" aria-label="Permalink to &quot;后端开发环境&quot;">​</a></h3><h4 id="go-语言环境" tabindex="-1">Go 语言环境 <a class="header-anchor" href="#go-语言环境" aria-label="Permalink to &quot;Go 语言环境&quot;">​</a></h4><p>Kube-Nova 后端基于 Go 语言开发，使用 go-zero 微服务框架。你需要安装 Go 1.22 或更高版本。安装完成后，请确保 <code>$GOPATH/bin</code> 已添加到系统 PATH 环境变量中，这样后续安装的 Go 工具才能在命令行中直接调用。</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 验证 Go 安装</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 确保 GOPATH/bin 在 PATH 中</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PATH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$PATH:$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> env</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GOPATH</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)/bin</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="安装-goctl-工具" tabindex="-1">安装 goctl 工具 <a class="header-anchor" href="#安装-goctl-工具" aria-label="Permalink to &quot;安装 goctl 工具&quot;">​</a></h4><p>goctl 是 go-zero 框架的代码生成工具，用于根据 API 定义文件和 Proto 文件自动生成服务代码骨架。这是开发过程中最核心的工具之一。</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> github.com/zeromicro/go-zero/tools/goctl@latest</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>安装完成后，可以通过 <code>goctl --version</code> 验证安装是否成功。更多详情请参考官方文档：<a href="https://go-zero.dev/docs/tasks/installation/goctl" target="_blank" rel="noreferrer">https://go-zero.dev/docs/tasks/installation/goctl</a></p><h4 id="安装-protoc-及相关插件" tabindex="-1">安装 protoc 及相关插件 <a class="header-anchor" href="#安装-protoc-及相关插件" aria-label="Permalink to &quot;安装 protoc 及相关插件&quot;">​</a></h4><p>protoc 是 Protocol Buffers 的编译器，用于编译 <code>.proto</code> 文件生成 gRPC 服务代码。go-zero 提供了一键安装命令，可以同时安装 protoc、protoc-gen-go 和 protoc-gen-go-grpc 三个组件。</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">goctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> env</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> check</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --verbose</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --force</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这个命令会检查当前环境，并自动下载安装缺失的组件。<code>--force</code> 参数确保即使组件已存在也会重新安装最新版本。更多详情请参考官方文档：<a href="https://go-zero.dev/docs/tasks/installation/protoc" target="_blank" rel="noreferrer">https://go-zero.dev/docs/tasks/installation/protoc</a></p><h3 id="前端开发环境" tabindex="-1">前端开发环境 <a class="header-anchor" href="#前端开发环境" aria-label="Permalink to &quot;前端开发环境&quot;">​</a></h3><h4 id="node-js-环境" tabindex="-1">Node.js 环境 <a class="header-anchor" href="#node-js-环境" aria-label="Permalink to &quot;Node.js 环境&quot;">​</a></h4><p>前端项目要求 Node.js 版本 &gt;= 20.19.0，包管理器使用 pnpm &gt;= 8.8.0。建议使用 nvm 管理 Node.js 版本，便于在不同项目间切换。</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 验证 Node.js 版本</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --version</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装 pnpm（如果尚未安装）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pnpm</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 验证 pnpm 版本</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --version</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><hr><h2 id="代码仓库" tabindex="-1">代码仓库 <a class="header-anchor" href="#代码仓库" aria-label="Permalink to &quot;代码仓库&quot;">​</a></h2><h3 id="后端仓库" tabindex="-1">后端仓库 <a class="header-anchor" href="#后端仓库" aria-label="Permalink to &quot;后端仓库&quot;">​</a></h3><table tabindex="0"><thead><tr><th>平台</th><th>仓库地址</th></tr></thead><tbody><tr><td>GitHub</td><td><a href="https://github.com/yanshicheng/kube-nova" target="_blank" rel="noreferrer">https://github.com/yanshicheng/kube-nova</a></td></tr><tr><td>Gitee</td><td><a href="https://gitee.com/ikubeops/kube-nova" target="_blank" rel="noreferrer">https://gitee.com/ikubeops/kube-nova</a></td></tr></tbody></table><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 克隆仓库（选择其一）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/yanshicheng/kube-nova.git</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://gitee.com/ikubeops/kube-nova.git</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 进入项目目录并下载依赖</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-nova</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tidy</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="前端仓库" tabindex="-1">前端仓库 <a class="header-anchor" href="#前端仓库" aria-label="Permalink to &quot;前端仓库&quot;">​</a></h3><table tabindex="0"><thead><tr><th>平台</th><th>仓库地址</th></tr></thead><tbody><tr><td>GitHub</td><td><a href="https://github.com/yanshicheng/kube-nova-web" target="_blank" rel="noreferrer">https://github.com/yanshicheng/kube-nova-web</a></td></tr><tr><td>Gitee</td><td><a href="https://gitee.com/ikubeops/kube-nova-web" target="_blank" rel="noreferrer">https://gitee.com/ikubeops/kube-nova-web</a></td></tr></tbody></table><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 克隆仓库（选择其一）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/yanshicheng/kube-nova-web.git</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://gitee.com/ikubeops/kube-nova-web.git</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 进入项目目录并安装依赖</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-nova-web</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><hr><h2 id="后端项目结构" tabindex="-1">后端项目结构 <a class="header-anchor" href="#后端项目结构" aria-label="Permalink to &quot;后端项目结构&quot;">​</a></h2><p>理解项目结构对于高效开发至关重要。Kube-Nova 后端采用典型的 go-zero 微服务架构，核心目录说明如下：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kube-nova/</span></span>
<span class="line"><span>├── application/          # 应用服务目录（核心开发区域）</span></span>
<span class="line"><span>│   ├── console-api/      # 控制台 API 服务</span></span>
<span class="line"><span>│   ├── console-rpc/      # 控制台 RPC 服务</span></span>
<span class="line"><span>│   ├── manager-api/      # 管理端 API 服务</span></span>
<span class="line"><span>│   ├── manager-rpc/      # 管理端 RPC 服务</span></span>
<span class="line"><span>│   ├── portal-api/       # 门户 API 服务</span></span>
<span class="line"><span>│   ├── portal-rpc/       # 门户 RPC 服务</span></span>
<span class="line"><span>│   └── workload-api/     # 工作负载 API 服务</span></span>
<span class="line"><span>├── common/               # 公共模块</span></span>
<span class="line"><span>│   ├── handler/          # 通用处理器</span></span>
<span class="line"><span>│   ├── interceptors/     # gRPC 拦截器</span></span>
<span class="line"><span>│   ├── k8smanager/       # Kubernetes 客户端管理</span></span>
<span class="line"><span>│   ├── middleware/       # HTTP 中间件</span></span>
<span class="line"><span>│   └── utils/            # 工具函数</span></span>
<span class="line"><span>├── pkg/                  # 可复用的包</span></span>
<span class="line"><span>│   ├── casbinadapter/    # Casbin 权限适配器</span></span>
<span class="line"><span>│   ├── jwt/              # JWT 认证</span></span>
<span class="line"><span>│   └── storage/          # 存储相关</span></span>
<span class="line"><span>├── template/             # goctl 代码生成模板</span></span>
<span class="line"><span>└── sql/                  # 数据库脚本</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>在 go-zero 的设计理念中，API 服务负责处理 HTTP 请求，而 RPC 服务则提供内部的 gRPC 调用。API 服务通常会调用一个或多个 RPC 服务来完成业务逻辑，这种分层设计使得服务之间的职责更加清晰。</p><hr><h2 id="makefile-指令详解" tabindex="-1">Makefile 指令详解 <a class="header-anchor" href="#makefile-指令详解" aria-label="Permalink to &quot;Makefile 指令详解&quot;">​</a></h2><p>项目提供了丰富的 Makefile 指令来简化开发流程。这些指令可以分为三类：通用指令、代码生成指令（gen-xxx）和服务运行指令（run-xxx）。</p><h3 id="通用指令" tabindex="-1">通用指令 <a class="header-anchor" href="#通用指令" aria-label="Permalink to &quot;通用指令&quot;">​</a></h3><table tabindex="0"><thead><tr><th>指令</th><th>说明</th></tr></thead><tbody><tr><td><code>make tidy</code></td><td>执行 <code>go mod tidy</code>，自动更新和清理依赖</td></tr><tr><td><code>make fmt</code></td><td>格式化所有 Go 代码</td></tr><tr><td><code>make vet</code></td><td>静态分析代码，检测潜在错误</td></tr><tr><td><code>make lint</code></td><td>使用 golangci-lint 进行代码质量检查</td></tr><tr><td><code>make test</code></td><td>运行单元测试</td></tr><tr><td><code>make build</code></td><td>构建当前平台的二进制文件，输出到 <code>dist/</code> 目录</td></tr><tr><td><code>make linux</code></td><td>交叉编译 Linux amd64 版本</td></tr><tr><td><code>make docker</code></td><td>构建 Docker 镜像并推送到 Harbor 仓库</td></tr><tr><td><code>make clean</code></td><td>清理构建产物</td></tr><tr><td><code>make help</code></td><td>显示所有可用指令的帮助信息</td></tr></tbody></table><h3 id="代码生成指令-gen-xxx" tabindex="-1">代码生成指令（gen-xxx） <a class="header-anchor" href="#代码生成指令-gen-xxx" aria-label="Permalink to &quot;代码生成指令（gen-xxx）&quot;">​</a></h3><p>代码生成指令是开发过程中的核心工具。当你修改了 <code>.api</code> 文件或 <code>.proto</code> 文件后，需要运行相应的生成指令来更新代码骨架。</p><h4 id="api-服务代码生成" tabindex="-1">API 服务代码生成 <a class="header-anchor" href="#api-服务代码生成" aria-label="Permalink to &quot;API 服务代码生成&quot;">​</a></h4><p>API 服务使用 <code>.api</code> 文件定义 HTTP 接口。goctl 会根据这个定义文件生成路由、handler、types 等代码。</p><table tabindex="0"><thead><tr><th>指令</th><th>作用</th></tr></thead><tbody><tr><td><code>make gen-portal-api</code></td><td>根据 <code>portal.api</code> 生成门户 API 服务代码</td></tr><tr><td><code>make gen-manager-api</code></td><td>根据 <code>manager.api</code> 生成管理端 API 服务代码</td></tr><tr><td><code>make gen-workload-api</code></td><td>根据 <code>workload.api</code> 生成工作负载 API 服务代码</td></tr><tr><td><code>make gen-console-api</code></td><td>根据 <code>console.api</code> 生成控制台 API 服务代码</td></tr></tbody></table><p>以 <code>gen-portal-api</code> 为例，它实际执行的命令是：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">goctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> api</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> go</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --api=application/portal-api/portal.api</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --dir=application/portal-api/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --style=goZero</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --home=./template</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这里的 <code>--home=./template</code> 参数指定了自定义模板目录，使生成的代码符合项目规范。<code>--style=goZero</code> 表示使用驼峰命名风格。</p><h4 id="rpc-服务代码生成" tabindex="-1">RPC 服务代码生成 <a class="header-anchor" href="#rpc-服务代码生成" aria-label="Permalink to &quot;RPC 服务代码生成&quot;">​</a></h4><p>RPC 服务使用 <code>.proto</code> 文件定义 gRPC 接口。生成过程会同时产生 protobuf 消息定义和 gRPC 服务代码。</p><table tabindex="0"><thead><tr><th>指令</th><th>作用</th></tr></thead><tbody><tr><td><code>make gen-portal-rpc</code></td><td>根据 <code>portal.proto</code> 生成门户 RPC 服务代码</td></tr><tr><td><code>make gen-manager-rpc</code></td><td>根据 <code>manager.proto</code> 生成管理端 RPC 服务代码</td></tr><tr><td><code>make gen-console-rpc</code></td><td>根据 <code>console.proto</code> 生成控制台 RPC 服务代码</td></tr></tbody></table><p>以 <code>gen-portal-rpc</code> 为例，它实际执行的命令是：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">goctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> protoc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --style=goZero</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --home=./template</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -I=application/portal-rpc/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --go_out=application/portal-rpc/pb/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --go_opt=module=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;github.com/yanshicheng/kube-nova/application/portal-rpc/pb&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --go-grpc_out=application/portal-rpc/pb/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --go-grpc_opt=module=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;github.com/yanshicheng/kube-nova/application/portal-rpc/pb&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --zrpc_out=application/portal-rpc/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  application/portal-rpc/portal.proto</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>命令参数说明：<code>-I</code> 指定 proto 文件的搜索路径；<code>--go_out</code> 和 <code>--go-grpc_out</code> 指定生成的 Go 代码输出目录；<code>--zrpc_out</code> 指定 go-zero 服务代码输出目录；<code>-m</code> 表示支持多个 proto 文件。</p><h3 id="服务运行指令-run-xxx" tabindex="-1">服务运行指令（run-xxx） <a class="header-anchor" href="#服务运行指令-run-xxx" aria-label="Permalink to &quot;服务运行指令（run-xxx）&quot;">​</a></h3><p>开发阶段使用这些指令可以快速启动单个服务进行调试，无需每次都完整构建。</p><table tabindex="0"><thead><tr><th>指令</th><th>作用</th></tr></thead><tbody><tr><td><code>make run-portal-api</code></td><td>启动门户 API 服务（端口见配置文件）</td></tr><tr><td><code>make run-portal-rpc</code></td><td>启动门户 RPC 服务</td></tr><tr><td><code>make run-manager-api</code></td><td>启动管理端 API 服务</td></tr><tr><td><code>make run-manager-rpc</code></td><td>启动管理端 RPC 服务</td></tr><tr><td><code>make run-workload-api</code></td><td>启动工作负载 API 服务</td></tr><tr><td><code>make run-console-api</code></td><td>启动控制台 API 服务</td></tr><tr><td><code>make run-console-rpc</code></td><td>启动控制台 RPC 服务</td></tr></tbody></table><p>以 <code>run-portal-api</code> 为例，它实际执行的命令是：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> application/portal-api/portal.go</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> application/portal-api/etc/portal-api.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>每个服务的配置文件位于对应目录的 <code>etc/</code> 子目录中，包含服务端口、数据库连接、Redis 配置等信息。启动服务前请确保配置文件已正确设置。</p><hr><h2 id="开发工作流" tabindex="-1">开发工作流 <a class="header-anchor" href="#开发工作流" aria-label="Permalink to &quot;开发工作流&quot;">​</a></h2><h3 id="新增-api-接口的典型流程" tabindex="-1">新增 API 接口的典型流程 <a class="header-anchor" href="#新增-api-接口的典型流程" aria-label="Permalink to &quot;新增 API 接口的典型流程&quot;">​</a></h3><p>当你需要为某个服务新增 HTTP 接口时，应该遵循以下步骤。这里以在 portal-api 服务中新增接口为例：</p><p>第一步，编辑 API 定义文件。打开 <code>application/portal-api/portal.api</code> 文件，按照 go-zero 的 API 语法添加新的接口定义，包括请求路径、方法、请求参数和响应结构。</p><p>第二步，生成代码骨架。运行 <code>make gen-portal-api</code> 命令，goctl 会根据更新后的 API 定义自动生成或更新路由注册、handler 函数签名和类型定义。</p><p>第三步，实现业务逻辑。在生成的 handler 文件中编写具体的业务逻辑。如果需要调用 RPC 服务，可以在 <code>svc/servicecontext.go</code> 中注入 RPC 客户端。</p><p>第四步，测试验证。运行 <code>make run-portal-api</code> 启动服务，使用 Postman 或 curl 测试新增的接口。</p><h3 id="新增-rpc-方法的典型流程" tabindex="-1">新增 RPC 方法的典型流程 <a class="header-anchor" href="#新增-rpc-方法的典型流程" aria-label="Permalink to &quot;新增 RPC 方法的典型流程&quot;">​</a></h3><p>当你需要新增内部 gRPC 调用方法时：</p><p>第一步，编辑 Proto 定义文件。打开对应服务的 <code>.proto</code> 文件（如 <code>application/portal-rpc/portal.proto</code>），添加新的 message 定义和 service 方法。</p><p>第二步，生成代码骨架。运行 <code>make gen-portal-rpc</code> 命令，生成 protobuf 序列化代码和 gRPC 服务骨架。</p><p>第三步，实现服务逻辑。在 <code>internal/logic/</code> 目录下找到对应的 logic 文件，实现具体的业务逻辑。</p><p>第四步，测试验证。运行 <code>make run-portal-rpc</code> 启动 RPC 服务，可以使用 grpcurl 或编写测试用例进行验证。</p><hr><h2 id="前端开发" tabindex="-1">前端开发 <a class="header-anchor" href="#前端开发" aria-label="Permalink to &quot;前端开发&quot;">​</a></h2><h3 id="启动开发服务器" tabindex="-1">启动开发服务器 <a class="header-anchor" href="#启动开发服务器" aria-label="Permalink to &quot;启动开发服务器&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-nova-web</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 首次运行或依赖更新后执行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 启动开发服务器，支持热更新</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>开发服务器启动后，默认会在本地开启一个端口（通常是 5173 或 3000），浏览器访问该地址即可预览前端界面。开发模式下支持热模块替换（HMR），修改代码后页面会自动刷新。</p><h3 id="构建生产版本" tabindex="-1">构建生产版本 <a class="header-anchor" href="#构建生产版本" aria-label="Permalink to &quot;构建生产版本&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build:prod</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>构建完成后，产物会输出到 <code>dist/</code> 目录，可以直接部署到 Nginx 或其他静态文件服务器。</p><hr><h2 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to &quot;常见问题&quot;">​</a></h2><h3 id="goctl-命令未找到" tabindex="-1">goctl 命令未找到 <a class="header-anchor" href="#goctl-命令未找到" aria-label="Permalink to &quot;goctl 命令未找到&quot;">​</a></h3><p>如果运行 <code>make gen-xxx</code> 时提示 <code>goctl: command not found</code>，说明 <code>$GOPATH/bin</code> 未加入 PATH 环境变量。请执行 <code>export PATH=$PATH:$(go env GOPATH)/bin</code> 并将此行添加到你的 shell 配置文件（如 <code>~/.bashrc</code> 或 <code>~/.zshrc</code>）中。</p><h3 id="protoc-相关错误" tabindex="-1">protoc 相关错误 <a class="header-anchor" href="#protoc-相关错误" aria-label="Permalink to &quot;protoc 相关错误&quot;">​</a></h3><p>如果生成 RPC 代码时出现 protoc 相关错误，请重新运行 <code>goctl env check --install --verbose --force</code> 确保所有组件正确安装。</p><h3 id="依赖下载缓慢" tabindex="-1">依赖下载缓慢 <a class="header-anchor" href="#依赖下载缓慢" aria-label="Permalink to &quot;依赖下载缓慢&quot;">​</a></h3><p>国内用户可以设置 Go 模块代理加速依赖下载：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> env</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GOPROXY=https://goproxy.cn,direct</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="服务启动失败" tabindex="-1">服务启动失败 <a class="header-anchor" href="#服务启动失败" aria-label="Permalink to &quot;服务启动失败&quot;">​</a></h3><p>请检查对应服务的配置文件（位于 <code>etc/</code> 目录）中的数据库、Redis、Etcd 等连接信息是否正确，以及相关基础服务是否已启动。</p>`,90)]))}const b=s(t,[["render",p]]);export{k as __pageData,b as default};
